---
layout: post
title: "JMX pour les nuls... - Les connecteurs - Partie 8"
date: 2010-12-20
comments: false
categories:
 - java
 - jmx
---

<div class='post'>
<div style="text-align: justify;"><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_XLL8sJPQ97g/TMdPuTpRY8I/AAAAAAAAALQ/R_w0PiLpvwo/s1600/jmx-cover.png" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" height="200" src="http://1.bp.blogspot.com/_XLL8sJPQ97g/TMdPuTpRY8I/AAAAAAAAALQ/R_w0PiLpvwo/s200/jmx-cover.png" width="171" /></a></div>Ce huitième et dernier article sur JMX&nbsp;clôture&nbsp;cette petite série de posts sur JMX (cf. <a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-introduction.html">introduction</a>, <a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html">partie 1 portant sur les généralités</a>, <a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html">partie 2 portant sur les différents MBeans et le concept de Notification</a>, <a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-agents-jmx-partie.html">partie 3 sur les agents JMX</a>, <a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-classes-de-base.html">partie 4 sur les classes de base</a>, <a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-le-mbean-server.html">partie 5 sur le MBeanServer</a>,&nbsp;<a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-chargement-dynamique.html">partie 6 sur le chargement dynamique des MBeans</a>&nbsp;et <a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-services-jmx.html">partie 7 sur les services JMX</a>). Il abordera&nbsp;succinctement&nbsp;la notion de connecteur.<br /><!-- more --><br /><br /><br /><br /><br /><br /><h1>Table des matières</h1><ul><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html">JMX, qu'est ce que c'est?</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#generalite">Généralités</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#architecture">Architecture JMX</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#instrumentation">Niveau instrumentation</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#agent">Niveau agent</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#distribue">Niveau service distribué</a></li></ul><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#composant">Composants JMX</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#mbean">MBeans</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#notification">Modèle de notifications</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#metadonnee">Classe de métadonnées de MBeans</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#serveur">Serveur de MBeans</a></li><li><a href="http://jetoile.blogspot.com/2010/10/jmx-pour-les-nuls-les-concepts-partie-1.html#services">Service d'agents</a></li></ul></ul><li>Spécifications</li><ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html">JMX Instrumentation</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html#mbean">MBean</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html#mbean_standard">MBean Standard</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html#mbean_dynamic">Dynamic MBean</a></li></ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html#notification">Notification</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html#mbean_open">Open MBean</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-differents-mbeans.html#mbean_model">Model MBean</a></li></ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-agents-jmx-partie.html#agent">Agent JMX</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-classes-de-base.html">Concepts</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-classes-de-base.html#objectname">ObjectName</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-classes-de-base.html#objectinstance">ObjectInstance</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-classes-de-base.html#attribute">Attribute et AttributeList</a></li><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-les-classes-de-base.html#exception">Les Exceptions</a></li></ul><li><a href="http://jetoile.blogspot.com/2010/11/jmx-pour-les-nuls-le-mbean-server.html">MBean Server</a></li><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-chargement-dynamique.html">Chargement dynamique des MBeans</a></li><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-services-jmx.html">Les services JMX</a></li><ul><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-services-jmx.html#monitoring">Service Monitoring</a></li><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-services-jmx.html#timer">Service Timer</a></li><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-services-jmx.html#relation">Service Relation</a></li><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-services-jmx.html#securite">Service Sécurité</a></li></ul><li><a href="http://jetoile.blogspot.com/2010/12/jmx-pour-les-nuls-les-connecteurs.html">Les Connecteurs</a></li></ul></ul><div>La spécification JMX défnit la notion de connecteurs : un connecteur est attaché à l'API JMX d'un MBean Server et le rend accessible de clients Java distants, le connecteur client possèdant une interface similaire à celle du MBean Server.</div><div>Un connecteur est donc constitué d'une partie cliente et d'une partie serveur :</div><div><ul><li>Le connecteur serveur est attaché au MBean Server et écoute les requêtes de connexion des clients</li><li>Le connecteur client a pour rôle de trouver le server et d'étable une connexion avec ce dernier. Un connecteur client se trouve généralement dans une JVM différente du connecteur serveur et s'exécutera même généralement sur une machine différente.</li></ul></div><div>Il est à noter que contrairement à un connecteur serveur, le connecteur client ne pourra se connecter qu'à un et un seul connecteur serveur (mais une application cliente pourra posséder plusieurs connecteurs clients).</div><div>JMX permet d'avoir de multiples connecteurs qui peuvent s'appuyer sur différents protocoles de communication entre le client et le serveur. Cependant, il définit le protocole standard et obligatoire sur tous serveurs JMX s'appuyant sur RMI (<em>Remote Method Invocation</em>) et le protocole optionel s'appuyant sur des sockets TCP et appelé JMXMP (<em>JMX Messaging Protocol</em>).&nbsp;</div><div></div><div>Les connecteurs distinguent deux notions distinctes qui sont la <strong>session</strong> et la <strong>connexion</strong>. Un connecteur client voit une session qui peut, tout au long de son cycle de vie de la session, avoir plusieurs connexions successives à un connecteur serveur. Il est à noter que, dans certains cas, il est possible d'avoir une connexion par requête (comme cela peut être le cas avec le protocole UDP ou JMS).</div><div>Une session possède un état sur le client mais pas nécessairement sur le connecteur serveur. Un connecteur, ne possède, quant à lui, pas forcément d'état.</div><div></div><div>Pour se connecter au connecteur serveur, le connecteur client peut utiliser une adresse du type "<em>service:jmx:jmxmp://host1:9876</em>". Si la requête de connexion aboutie, le point d'accès client du connecteur client est retourné en réponse.&nbsp;</div><div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_XLL8sJPQ97g/TQ0JWJXGzAI/AAAAAAAAAQo/b1hs_49t0Ys/s1600/jmx75.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://2.bp.blogspot.com/_XLL8sJPQ97g/TQ0JWJXGzAI/AAAAAAAAAQo/b1hs_49t0Ys/s400/jmx75.png" width="400" /></a></div></div><div><div>Du point de vue de la connexion cliente, le code de l'utilisateur peut obtenir un objet qui implémente l'interface <em>MBeanServerConnection</em>. Cette interface étant similaire à l'interface <em>MBeanServer</em>, il devient transparent pour le code de l'application cliente d'interagir avec un MBean Server ne se trouvant pas dans la même JVM.&nbsp;</div><div>En fait, l'interface <em>MBeanServerConnection</em> est étendue par l'interface <em>MBeanServer</em> et contient donc toutes les méthodes principales sauf celles qui n'ont de sens que pour une utilisation locale.</div></div><div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TQ0Js7mndfI/AAAAAAAAAQs/puPa9Bkgz1Y/s1600/jmx68.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="286" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TQ0Js7mndfI/AAAAAAAAAQs/puPa9Bkgz1Y/s320/jmx68.png" width="320" /></a></div></div><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Lors de l'enregistrement d'un écouteur auprès du <em>MBeanServerConnection</em>, le connecteur s'assure de la transmission de la notification de la partie serveur du connecteur à la partie cliente, puis à l'écouteur.<br />Les détails de la mise en œuvre de la transmission de la notification sont dépendants du protocole.</td></tr></tbody></table><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Lors de l'utilisation d'un filtre de notifications, le filtrage des notifications reçues peut être effectué soit par la partie cliente du connecteur, soit par le MBean Server suite à la transmission du filtre.<br />Il est, bien sûr, à noter que le filtrage des notifications coté serveur évite la transmission des notifications sur le réseau.<br />Cependant, il est conseillé de rendre les filtres indépendants de leur lieu d'exécution (pour rappel, l'interface <em>NotificationFilter</em> étend l'interface <em>Serializable</em>).</td></tr></tbody></table>Toutes les implémentations des connecteurs coté serveur doivent posséder un buffer de notifications qui correspond à la liste de toutes notifications émises par les MBeans à destination du MBean Server. Il est à noter que les connecteurs doivent supporter les requêtes concurrentes pour des raisons évidentes. Concernant l'adresse du serveur connecteur, il est conseillé, pour la générer, de passer par la classe <em>JMXServiceURL</em>. <div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_XLL8sJPQ97g/TQ0J6oZ__RI/AAAAAAAAAQw/HbReQRkRJtk/s1600/jmx69.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/_XLL8sJPQ97g/TQ0J6oZ__RI/AAAAAAAAAQw/HbReQRkRJtk/s320/jmx69.png" width="224" /></a></div>Afin de créer la partie cliente d'un connecteur, il existe deux possibilités : <ul><li>si l'adresse du serveur est connue, la méthode <em>connect(JMXServiceURL)</em> de la classe statique <em>JMXConnectorFactory</em> peut être utilisée,</li><li>sinon, il est possible d'interroger le serveur pour obtenir un stub de <em>JMXConnector</em>.</li></ul>Du point de vue de la connexion serveur, la connexion serveur est représentée par une sous-classe de <em>JMXConnectorServer</em> qui peut être obtenue : <ul><li>soit à l'aide de &nbsp;la classe statique <em>JMXConnectorServerFactory</em> en lui indiquant le paramètre de type <em>JMXServiceURL</em> qui lui permet de connaitre les classes à instancier,</li><li>soit en instanciant directement la sous-classe de <em>JMXConnectorServer</em>.</li></ul>Le connecteur serveur doit être attaché à un MBean Server (ce qui ne signifie pas qu'il doit s'enregistré en son sein) et doit être actif pour être utilisable. Il peut être attaché auprès du MBean Server de deux manières : <ul><li>Le MBean Server auquel est attaché le connecteur serveur lui est spécifié lors de sa construction</li><li>Le connecteur serveur est enregistré auprès du MBean Server comme s'il s'agissait d'un MBean</li></ul><div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_XLL8sJPQ97g/TQ0KE210zHI/AAAAAAAAAQ0/uN68yvrtjr4/s1600/jmx71.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="281" src="http://2.bp.blogspot.com/_XLL8sJPQ97g/TQ0KE210zHI/AAAAAAAAAQ0/uN68yvrtjr4/s400/jmx71.png" width="400" /></a></div></div><div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TQ0KUwpcisI/AAAAAAAAAQ4/oWKoFdTIM4k/s1600/jmx70.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="39" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TQ0KUwpcisI/AAAAAAAAAQ4/oWKoFdTIM4k/s320/jmx70.png" width="320" /></a></div></div><div><div><span style="white-space: pre;"> </span>Exemple de création et d'attachement d'un connecteur serveur auprès d'un MBean Server</div><div><pre class="brush:java; wrap-lines: false; auto-links: false">MBeanServer mbs = MBeanServerFactory.createMBeanServer();<br />JMXServiceURL addr = new JMXServiceURL("jmxmp", null, 0);<br />JMXConnectorServer cs = JMXConnectorServerFactory.newJMXConnectorServer(addr, null, mbs);<br />cs.start();<br /></pre></div><div><span style="white-space: pre;"> </span>Exemple de création et d'enregistrement d'un connecteur serveur dans un MBean Server</div><div><pre class="brush:java; wrap-lines: false; auto-links: false">MBeanServer mbs = MBeanServerFactory.createMBeanServer();<br />JMXServiceURL addr = new JMXServiceURL("jmxmp", null, 0);<br />JMXConnectorServer cs = JMXConnectorServerFactory.newJMXConnectorServer(addr, null, null);<br />ObjectName csName = new ObjectName(":type=cserver,name=mycserver");<br />mbs.registerMBean(cs, csName);<br />cs.start();<br /></pre></div><div>JMX définit également comment un agent peut publier son serveur de connexion dans une infrastructure de recherche et de découverte ; ce qui permet à l'API cliente distante de savoir où trouver un serveur et ainsi de pouvoir si connecter. Cela couvre :</div><div><ul><li>SLP (<em>Service Location Protocol</em>) en décrivant comme un agent enregistre le service URL d'un connecteur serveur avec SLP</li><li>Jini en décrivant comment un agent enregistre un stub du connecteur serveur dans le service de recherche Jini</li><li>JNDI (<em>Java Naming and Directory Interface</em>) en décrivant un agent enregistre le service URL d'un connecteur dans un annuaire LDAP</li></ul></div><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Un connecteur client peut spécifier un class loader par défaut lorsqu'il effectue sa connexion au serveur. Ce class loader est alors utilisé lors de la déserialisation des objets reçus du serveur que ce soit les valeurs retournées, les exceptions ou les notifications.<br />Le class loader par défaut est positionné par la valeur de l'attribut <em>jmx.remote.default.class.loader</em> définie par l'environnement <em>JMXConnector</em>, sinon, il s'agit du class loader du contexte.</td></tr></tbody></table><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Le class loader utilisé par le connecteur serveur pour déserialiser les paramètres reçus par le connecteur client est dépendant de l'opération : en effet, parfois, il peut s'agir de celui du MBean cible (si les types de paramètres ne sont pas définis par l'API JMX), parfois, de celui configuré pendant la création du connecteur server (s'il est prévu de l'utiliser dans une application de gestion particulière qui peut définir ses propres sous classes de types de paramètres de MBean ou <em>NotificationFilter</em>).<br />Le connecteur serveur possède un class loader par défaut qui est déterminé lors de son démarrage comme suit :<br /><ul><li>Si l'attribut <em>jmx.remote.default.class.loader</em> de l'environnement existe, sa valeur détermine le class loader à utiliser</li><li>Si l'attribut <em>jmx.remote.default.class.loader.name</em> de l'environnement existe, sa valeur détermine l'ObjectName du MBean à utiliser comme class loader par défaut. Cette fonctionnalité permet à un connecteur serveur d'être créé avec un class loader qui est un m-let dans le même MBean Server</li><li>Sinon, c'est le class loader du thread contextuel qui est utilisé</li></ul>Pour plus d'informations sur l'utilisation de class loader étendu, il est recommandé de se référer au chapitre 13.11 Class Loading de la spécification JMX.</td></tr></tbody></table><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Afin d'éviter les difficultés avec le fonctionnement des class loader Java, il est conseillé de n'utiliser que les types standards Java ou fournis par l'API JMX ou les Open MBeans qui permettent des structures plus complexes. De même, pour les notifications, il est préconisé de n'utiliser que les notifcations suivantes :<br /><ul><li><em>NotificationFilterSupport</em></li><li><em>MBeanServerNotificationFilter</em></li><li><em>AttributeChangeNotificationFilter</em></li></ul></td></tr></tbody></table>Le connecteur serveur est, en outre, capable d'authentifier le client distant. Par exemple, pour le connecteur RMI, cela est fait fournissant une implémentation de l'interface <em>JMXAuthenticator</em> lors de la création du connecteur serveur. Dans le cas du connecteur JMXMP, cela est fait via SASL. Dans ces deux cas, le résultat de l'authentification renvoie un Subject JAAS qui représente l'identité authentifiée. Les requêtes alors reçues du client sont exécutées en utilisant cette identité. Avec JAAS, il est possible de définir les permissions liées à une identité. En particulié, il est possible de restreindre l'accès aux opérations du MBean Server en utilisant la classe <em>MBeanPermission</em>. Bien sûr, pour que cela fonctionne, il est nécessaire d'avoir un <em>SecurityManager</em>. Dans le cas où le connecteur serveur ne supporte pas l'authentification ou qu'il n'est pas configuré, les requêtes clientes sont exécutées en utilisant la même identité que celle qui a été créée avec le connecteur serveur. Comme alternative à JAAS, il est possible de controler l'accès aux opérations du MBean Server en utilisant un <em>MBeanServerForwarder</em>. Cet objet est une implémentation de l'interface <em>MBeanServer</em> et transmet les méthodes à un autre objet <em>MBeanServer</em> mais en ajoutant des opérations avant et après la transmission. Cela permet, en l'occurrence d'y faire des controles d'accès. Pour ajouter un <em>MBeanServerForwarder</em>, la méthode <em>setMBeanServerForwarder</em> peut être utilisée. De plus, pour chaque connexion à un connecteur serveur, au moins un <em>Subject</em> authentifié est néccessaire. Cela signifie que si un client effectue des opérations qui nécessitent plusieurs identités, des connexions différentes doivent être établies. Cependant, il est possible aux connecteurs (tels que les connecteurs RMI et JMXMP) d'utiliser la notion de délégation de <em>Subject</em>. Pour ce faire, avec chaque requête, le client spécifie un <em>Subject</em>. La requête est alors exécutée en utilisant une identité pour chaque requête si cela est possible. La permission a utilisé doit alors être de type <em>SubjectDelegationPermission</em>. Dans ce cas, pour chaque Subject délégué, le client obtient un <em>MBeanServerConnection</em> du <em>JMXConnector</em> pour un <em>Subject</em> authentifié. Les requêtes utilisées par le <em>MBeanServerConnection</em> sont émises avec un <em>Subject</em> délégué. Il est, de plus, à noter que ces objets de type <em>MBeanServerConnection</em> peuvent être obtenus du même <em>JMXConnector</em> et peuvent être utilisés simultanément. Ainsi, pour résumer, il est possible de configurer les permissions d'un connecteur serveur de deux manières : <ul><li>toutes les permissions pour les opérations de chaque client distant doivent être configurées,</li><li>un <em>SubjectDelegationPermission</em> pour chaque <em>Principal</em> utilisé par les clients distants doit être configuré.</li></ul><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Le connecteur RMI est le seul connecteur qui doit être présent dans les implémentations de JMX. Il utilise l'infrastructure RMI (Remote Method Invocation) pour la communication entre le client et le serveur.<br />RMI définit deux couches de transport standard :<br /><ul><li><em>Java Remote Method Protocol</em> (JRMP) qui est le protocole de transport par défaut</li><li><em>Internet Inter-ORB Protocol</em> (IIOP) qui est le protocole défini par CORBA et qui permet l'interopérabilité avec un autre langage de programmation</li></ul>Pour chaque serveur de connexion RMI, un objet distant implémentant l'interface distante RMIServer existe. Un client voulant communiquer avec le connecteur serveur doit obtenir une référence distante (ou stub) connecté à cet objet distant. Via RMI, chaque méthode appelée sur un stub sera transféré à l'objet distant. Ainsi, le client possédant un stub sur l'objet <em>RMIServer</em> pourra appeler obtenir le même résultat que s'il avait appelé l'objet du serveur.<br />De plus, il existe un objet distant pour chaque connexion cliente qui permet de créer un nouvel objet distant qui implémente l'interface distante <em>RMIConnection</em>.<br />Enfin, il est à noter que le code de l'utilisateur n'interagit généralement pas directement avec les objets du <em>RMIServer</em> ou du <em>RMIConnection</em> : en général, le stub <em>RMIServer</em> est obtenu au travers d'un objet <em>RMIConnector</em> qui implémente l'interface <em>JMXConnector</em>.<br />L'obtention de cet objet <em>RMIConnector</em> peut être fait de trois manières :<br /><ul><li>En fournissant un <em>JMXServiceURL</em> au <em>JMXConnectorFactory</em> qui spécifie le protocol RMI ou IIOP.</li><li>En obtenant le stub <em>JMXConnector</em> de " quelque part " (annuaire LDAP, Service de lookup JNDI, …).</li><li>En obtenant un stub <em>RMIServer</em> de " quelque part " et qui peut être utilisé comme paramètre du constructeur de <em>RMIConnector</em>.</li></ul>Les notions de sécurité et de versionnement sont également décrites dans le spécification JMX (et plus particulièrement la JSR160). Cependant, ce document n'abordera pas ces points.</td></tr></tbody></table><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>La spécification JMX (et plus précisément la JSR160) décrit comment implémenter un connecteur générique en précisant comment configurer par plugin son protocole de transport ainsi que la manière dont il encapsule les objets transitant du client au serveur et plus particulièrement sa gestion du classloader du MBean cible.<br />Cependant, ce document n'abordera pas ces points. Aussi, pour plus d'informations, il est conseillé de se référer à la JSR160 ou aux chapitres 15 -&nbsp;<em>Generic Connector</em> et 16 -&nbsp;<em>Defining a new transport</em> des spécifications agrégées JMX.</td></tr></tbody></table><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>Le connecteur JMXMP est une configuration particulière du connecteur générique où le protocole de transport s’appuie sur TCP et l’encapsulation des objets est la sérialisation native Java.</td></tr></tbody></table><table border="1" cellpadding="0" cellspacing="0" style="margin-left: 0px; margin-right: 0px; text-align: justify;"><tbody><tr><td><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img alt="" border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/TNCS7qzv19I/AAAAAAAAAL4/6qkEYy4pX6o/s1600/remarque.png" style="cursor: move;" /></a></td><td>La spécification JMX ne spécifie pas comment trouver l'adresse d'un serveur de connecteurs attaché à un agent connu ou comment découvrir les agents présents dans le système ainsi que ce qu'ils proposent. Cependant, la JSR160 propose trois infrastructures permettant de répondre à ces besoins :<br /><ul><li>SLP (<em>Service Location Protocol</em>)</li><li>JINI</li><li>JNDI (<em>Java Naming and Discovery Interface</em>) utilisé au travers un annuaire LDAP</li></ul><br />Bien sûr, les APIs pour utiliser ces différentes technologies diffèrent cependant, les principes généraux restent identiques :<br /><ul><li>L'agent créé un ou plusieurs serveurs de connecteurs</li><li>Pour chacun des connecteurs à exposer, il expose soit le <em>JMXServiceURL</em> (dans le cas de SLP ou JNDI), soit le stub <em>JMXConnector</em> (dans le cas de JINI ou JNDI) qu'il enregistre dans le service de recherche (en spécifiant au besoin d'autres méta-données)</li><li>Le client interroge le service de recherche pour obtenir un ou plusieurs <em>JMXServiceURL</em> ou stub <em>JMXConnector</em></li><li>Le client utilise soit le factory <em>JMXConnectorFactory</em> pour obtenir un <em>JMXConnector</em> connecté au serveur s'il possède un <em>JMXServiceURL</em>, soit se connecte directement au serveur en utilisant le stub <em>JMXConnector</em></li></ul>Ce document ne fournira pas plus d'informations sur ces points. Aussi, pour plus d'informations, il est conseillé de se référer à la JSR160 ou au chapitres 17 -<em>&nbsp;Bindings to lookup services</em> des spécifications agrégées JMX.</td></tr></tbody></table></div></div><ol style="text-align: justify;"><li>Le mot de la fin</li></ol><div style="text-align: justify;">Voilà, ce dernier article met fin à cette série. Si vous avez réussi à tenir jusque là et à tout lire, félicitation! Maintenant, vous devriez avoir (enfin, j'espère) une vision plus précise sur ce que contiennent les spécifications JMX. Bien sûr, cette série n'était qu'un condensée (qui vaut ce qu'il vaut) permettant de comprendre les concepts sans pour autant lire les 290 pages de spécification et ne se veut pas être suffisante pour tout&nbsp;maîtriser.</div></div>
