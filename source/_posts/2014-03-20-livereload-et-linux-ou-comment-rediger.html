---
layout: post
title: "Livereload et Linux ou comment rédiger du html simplement"
date: 2014-03-20
comments: false
categories:
 - divers
 - html
---

<div class='post'>
<div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-iICRkMH0vhY/UxnsLscNtII/AAAAAAAABRA/uXMjhVZjOBg/s1600/ubuntu_livereload.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-iICRkMH0vhY/UxnsLscNtII/AAAAAAAABRA/uXMjhVZjOBg/s1600/ubuntu_livereload.png" height="320" width="309" /></a></div><div style="text-align: justify;">Cet article n'a rien à voir avec le monde Java.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Il s'agit plus d'un petit tutoriel surtout destiné... à moi-même... ;-)</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">En effet, mon blog étant hébergé sur blogger, lorsque je rédige un article, je le fais le plus souvent directement en HTML. Afin d'avoir une idée de l'aperçu, je le charge directement dans mon navigateur mais passer son temps à faire du <b>Alt-Tab/F5</b> a rapidement commencé à m'énerver.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Aussi, ayant entendu parlé depuis un moment de <a href="http://livereload.com/">livereload</a>, je me suis dis que cela pouvait être pas mal de l'utiliser.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Cependant, j'avoue avoir subi un échec cuisant (je suis sous un environnement linux et je tiens à préciser que je ne suis pas des plus à l'aise avec le monde nodejs ou ruby - ceci explique aussi cela... ;-) ) et cela malgré avoir mes multiples tentatives (à coup de <i>gem install</i>) et recherche sur mon ami Google (enfin, quand on n'est pas doué, on n'est pas doué... :'( )</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Du coup, j'ai pris l'option :</div><blockquote><div style="text-align: justify;">"J'appelle un ami" </div></blockquote><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Dans mon cas, je remercie <a href="https://twitter.com/hcapitaine">Harold</a>&nbsp;pour son aide.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Il m'a conseillé de me jeter un oeil sur <a href="http://gruntjs.com/">Grunt</a>&nbsp;qui gérait nativement livereload (bon, pour ma défense, je n'avais pas prévu de partir sur Grunt... ;-) ). </div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Cet article présentera donc comment j'ai réussi à faire fonctionner le bouzin avec, en prime, la possibilité d'utiliser Markdown. </div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Concernant l'environnement, il s'agit d'Ubuntu 13.10 (sur Mac, je ne doute pas que cela aurait été plus simple mais bon...)</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">[NDLR : encore une fois, je précise que je ne suis pas du tout expert dans ce domaine, il est donc inutile de me poser des questions. Par contre, toutes propositions d'amélioration est la bienvenue ;-)]<br /><br />A titre informatifs, les fichiers se trouvent sur <a href="https://github.com/jetoile/livereload-grunt">Github</a>.</div><div style="text-align: justify;"></div><!-- more --><br /><br /><h1 id="installation-de-nodejs-de-npm-et-de-grunt">Installation de nodejs, de npm et de grunt</h1><div style="text-align: justify;">Dans un premier temps, il convient d'installer tout le strict minimum afin de permettre à Grunt de fonctionner.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Installation de NodeJS :</div><pre><code class="lang-bash">sudo apt-get install nodejs</code></pre><br />Installation de Npm :<br /><pre><code class="lang-bash">sudo apt-get install npm</code></pre><br />Installation de Grunt (de manière global au système) :<br /><pre><code class="lang-bash">sudo npm install -g grunt-cli</code></pre><br /><div style="text-align: justify;">Installer le <a href="http://feedback.livereload.com/knowledgebase/articles/86242-how-do-i-install-and-use-the-browser-extensions-">plugin</a> livereload sur Chrome ou Firefox.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Dans le cas de Chrome, pensez à modifier sa configuration pour qu'il autorise l'accès aux URLs de fichiers.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-jg_Pm58wTpc/Uxno8Z2A74I/AAAAAAAABQo/zUsVZpiPSz4/s1600/chrome-config.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-jg_Pm58wTpc/Uxno8Z2A74I/AAAAAAAABQo/zUsVZpiPSz4/s1600/chrome-config.png" height="107" width="640" /></a></div><div style="text-align: justify;"><br /></div><h1 id="configuration-de-grunt">Configuration de Grunt</h1><div style="text-align: justify;">Par la suite, toutes les opérations seront effectué dans le répertoire <strong>$HOME/tmp</strong>.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Une fois tous les logiciels installés, il ne reste qu'à créer les fichiers nécessaires au bon fonctionnement de Grunt :</div><ul><li style="text-align: justify;"><strong>package.json</strong> qui permet de télécharger les modules et de les installer localement dans répertoire courant (un peu comme la rubrique <em>dependencies</em> de Maven),</li><li style="text-align: justify;"><strong>gruntfile.js</strong> qui permet de configurer les différents modules précédemment installés par la commande <em>npm install</em> (un peu comme la rubrique <em>build/plugins</em> de Maven). </li></ul><strong>$HOME/tmp/package.json</strong><br /><pre><code class="lang-js">{<br />  "name": "yo",<br />  "version": "0.0.0",<br />  "dependencies": {},<br />  "devDependencies": {<br />    "grunt": "~0.4.1",<br />    "matchdep": "~0.1.2",<br />    "grunt-express": "~1.0.0-beta2",<br />    "grunt-contrib-watch": "~0.5.1",<br />    "grunt-open": "~0.2.1"<br />  },<br />  "engines": {<br />    "node": "&gt;=0.8.0"<br />  }<br />}</code></pre><br /><div style="text-align: justify;">Il convient maintenant de lancer le téléchargement et l'installation des modules en exécutant la commande suivante :</div><pre><code class="lang-bash">npm install</code></pre><br /><div style="text-align: justify;">Ne reste plus qu'à configurer les modules via le fichier <em>Gruntfile.js</em>.</div><strong><br /></strong><strong>$HOME/tmp/Gruntfile.js</strong><br /><pre><code class="lang-js"><br />module.exports = function(grunt) {<br /><br />  // Load Grunt tasks declared in the package.json file<br />  require('matchdep').filterDev('grunt-*').forEach(grunt.loadNpmTasks);<br /><br />  grunt.initConfig({<br /><br />    // grunt-express will serve the files from the folders listed in `bases` on specified `port` and `hostname`<br />    express: {<br />      all: {<br />        options: {<br />          port: 9000,<br />          hostname: "0.0.0.0",<br />          bases: ['html'], // Replace with the directory you want the files served from<br />                              // Make sure you don't use `.` or `..` in the path as Express<br />                              // is likely to return 403 Forbidden responses if you do<br />                              // http://stackoverflow.com/questions/14594121/express-res-sendfile-throwing-forbidden-error<br />          livereload: true<br />        }<br />      }<br />    },<br /><br />    // grunt-watch will monitor the projects files<br />    watch: {<br />      all: {<br />        files: '*.html',<br />        options: {<br />          livereload: true<br />        }<br />      }<br />    },<br /><br />    // grunt-open will open your browser at the project's URL<br />    open: {<br />      all: {<br />        path: 'http://localhost:&lt;%= express.all.options.port%&gt;'<br />      }<br />    }<br />  });<br /><br />  // Creates the `server` task<br />  grunt.registerTask('default', [<br />    'express',<br />    'open',<br />    'watch'<br />  ]);<br />};</code></pre><br /><div style="text-align: justify;">Cette configuration est fonctionnelle avec l'arborescence suivante :</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-yzXs78VTiFw/Uxnor5jGo_I/AAAAAAAABQY/01_s7DCQHT4/s1600/arbo01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-yzXs78VTiFw/Uxnor5jGo_I/AAAAAAAABQY/01_s7DCQHT4/s1600/arbo01.png" /></a></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Dans cette dernière et avec cette configuration, tous les fichiers du répertoire <em>html</em> avec l'extension <em>.html</em> seront suivis par livereload. Aussi, il suffit de créer un fichier html dans le répertoire html (par exemple html/sample.html) et de lancer la commande :</div><pre style="text-align: justify;"><code class="lang-bash">grunt</code></pre><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Le navigateur par défaut s'ouvrira alors avec l'url : <em><a href="http://localhost:9000/">http://localhost:9000/</a></em>. Il suffit d'y ajouter la page voulu (dans notre exemple <a href="http://localhost:9000/sample.html">http://localhost:9000/sample.html</a>) et d'activer le plugin livereload. </div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-edBGc5pdGLg/UxnpKGFtjsI/AAAAAAAABQw/E6maHZkgGcs/s1600/icon_livereload.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-edBGc5pdGLg/UxnpKGFtjsI/AAAAAAAABQw/E6maHZkgGcs/s1600/icon_livereload.png" /></a></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Il ne reste plus qu'à modifier le fichier html et lors de sa sauvegarde, la page sera automatiquement mis à jour dans le navigateur!</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Si l'erreur suivante apparait :</div><blockquote><div style="text-align: justify;">/usr/bin/env: node: Aucun fichier ou dossier de ce type</div></blockquote><div style="text-align: justify;">Il faut installer nodejs-legacy (cf. <a href="https://github.com/volojs/volo/issues/154">ici</a>)</div><pre><code class="lang-bash">sudo apt-get install nodejs-legacy</code></pre><h1 id="configuration-de-grunt-pour-l-int-gration-de-markdown">Configuration de Grunt pour l'intégration de Markdown</h1><div style="text-align: justify;">L'intégration de Markdown se fait de la même manière que précédemment.</div><div style="text-align: justify;">Les fichiers <strong>package.json</strong> et <strong>Gruntfile.js</strong> se voient juste ajouter le module <strong>grunt-markdown</strong><strong>package.json</strong></div><pre><code class="lang-js">{<br />  "name": "yo",<br />  "version": "0.0.0",<br />  "dependencies": {},<br />  "devDependencies": {<br />    "grunt": "~0.4.1",<br />    "matchdep": "~0.1.2",<br />    "grunt-express": "~1.0.0-beta2",<br />    "grunt-contrib-watch": "~0.5.1",<br />    "grunt-open": "~0.2.1",<br />    "grunt-markdown": "~0.5.0"<br />  },<br />  "engines": {<br />    "node": "&gt;=0.8.0"<br />  }<br />}</code></pre><strong><br /></strong><strong>Gruntfile.js</strong><br /><pre><code class="lang-js"><br />module.exports = function(grunt) {<br />  require('matchdep').filterDev('grunt-*').forEach(grunt.loadNpmTasks);<br /><br />  grunt.initConfig({<br /><br />     markdown: {<br />      all: {<br />        files: [<br />          {<br />            expand: true,<br />            src: '*.md',<br />            dest: 'html/',<br />            ext: '.html'<br />          }<br />        ]<br />      }<br />    },<br /><br />    express: {<br />      all: {<br />        options: {<br />          port: 9000,<br />          hostname: "0.0.0.0",<br />          bases: ['html'], <br />          livereload: true<br />        }<br />      }<br />    },<br /><br />    watch: {<br />      all: {<br />        files: ['*.md','*.html'],<br />        tasks : ['markdown'],<br />        options: {<br />          livereload: true<br />        }<br />      }<br />    },<br /><br />    open: {<br />      all: {<br />        path: 'http://localhost:&lt;%= express.all.options.port%&gt;'<br />      }<br />    }<br />  });<br /><br />  grunt.registerTask('default', [<br />    'markdown',<br />    'express',<br />    'open',<br />    'watch'<br />  ]);<br />};</code></pre><br />Suite à la modification de ces fichiers (attention à penser de faire un <em>npm install</em> après modification du fichier <strong>package.json</strong>), il est alors possible d'écrire son document en Markdown.<br /><br />L'arborescence à respecter par rapport à la configuration est la suivante :<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-kgC6a8jRwG8/Uxno29Sr9EI/AAAAAAAABQg/lf3W_rnDAvU/s1600/arbo02.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-kgC6a8jRwG8/Uxno29Sr9EI/AAAAAAAABQg/lf3W_rnDAvU/s1600/arbo02.png" /></a></div><br />Lors de la modification du fichier .md, son pendant html sera automatiquement créé (ou modifié) et pris en compte par un rechargement du navigateur.<br /><h1 id="conclusion">Conclusion</h1>Comme on a pu le voir, au final, configurer livereload pour permettre un rechargement automatique lors de la modification d'un fichier HTML ou Markdown n'est pas si compliquée une fois que l'on a tous les fichiers et les bons modules configurés.<br /><br />D'ailleurs, cet article est le premier écrit en Markdown (quand je disais que ce n'était pas ma tasse de thé...).<br /><br />En espérant qu'il pourra être utile à d'autres lecteurs et en m'excusant par avance si des informations sont approximatives...<br /><h1 id="pour-aller-plus-loin-">Pour aller plus loin...</h1><ul><li><a href="http://rhumaric.com/2013/07/renewing-the-grunt-livereload-magic/">http://rhumaric.com/2013/07/renewing-the-grunt-livereload-magic/</a><br /> </li><li><a href="http://justinklemm.com/grunt-watch-livereload-javascript-less-sass-compilation/">http://justinklemm.com/grunt-watch-livereload-javascript-less-sass-compilation/</a><br /> </li><li><a href="http://feedback.livereload.com/knowledgebase/articles/86242-how-do-i-install-and-use-the-browser-extensions-">http://feedback.livereload.com/knowledgebase/articles/86242-how-do-i-install-and-use-the-browser-extensions-</a><br /> </li><li><a href="http://blog.roddet.com/2013/12/nantesjs-gruntjs/">http://blog.roddet.com/2013/12/nantesjs-gruntjs/</a><br /> </li><li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#wiki-lists">https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#wiki-lists</a><br /> </li></ul></div>
