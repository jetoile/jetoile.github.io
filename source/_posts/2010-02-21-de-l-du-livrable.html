---
layout: post
title: "De l'art du livrable"
date: 2010-02-21
comments: false
categories:
 - java
 - maven
---

<div class='post'>
<div style="text-align: justify;" xmlns="http://www.w3.org/1999/xhtml"><div class="separator" style="clear: both;"><a href="http://3.bp.blogspot.com/_XLL8sJPQ97g/S4Gsb3IQnEI/AAAAAAAAAIo/mXDdrzwnmL0/s1600-h/zip.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/_XLL8sJPQ97g/S4Gsb3IQnEI/AAAAAAAAAIo/mXDdrzwnmL0/s320/zip.png" /></a></div>Au cours de certaines missions, je suis arrivé à un constat qui était que le processus de génération d'un livrable était souvent délaissé au profit de l'effort de développement de l'application.<br />C'est vrai qu'il peut être concevable qu'il ne s'agit que de la dernière étape d'un processus de développement, cependant, avec l'introduction de cycles courts (agilité, ...), pouvoir fournir rapidement un livrable de qualité au client est primordial.<br />Dans un <a href="http://jetoile.blogspot.com/2010/01/retour-sur-la-mise-en-uvre-d_04.html">post précédent</a>, j'avais parler de la façon dont j'avais en place maven dans un processus d'usine logicielle. J'y avais également abordé succinctement comment il était possible de générer un livrable.<br />Ce post présente donc plus précisément comment cela est possible avec maven (je ne reviendrai pas sur le pourquoi car cela me parait évident dans le sens où c'est ce que verra le client final et que, tout le monde le sait, la première impression est très souvent importante - un peu comme lorsque l'on offre un cadeau à quelqu'un, l'emballage à son importance même si, au final, le cadeau est pourri... ;-) - ).<br /><!-- more --><br /><h1>Cahier des charges</h1>L'application de référence sera une application simple de type J2SE (nommé foo) qui devra pouvoir s'exécuter de manière simple en exécutant par exemple un .bat ou un .sh.<br />Le livrable devra contenir la javadoc de l'application ainsi que son code source.<br />Il pourra optionnellement venir avec un fichier README qui précisera certaines informations (version, howto, issues, ...).<br />Enfin, il sera supposé que le client ne dispose que d'un JRE sur la machine où sera amenée à être exécutée l'application.<br /><br />Le livrable devra contenir :<br /><ul><li>dans le répertoire lib, toutes les librairies nécessaires à l'exécution de l'application,</li><li>dans le répertoire api, la javadoc de notre application,</li><li>dans le répertoire source, les sources de l'application sous forme de jar,</li><li>à la racine, le fichier README ainsi que les .bat et .sh nécessaires à l'exécution de l'application.<br /></li></ul><h1>Mise en œuvre</h1><h2>Méthodologie</h2>Comme vous l'aurez compris, maven 2 sera notre outil pour gérer notre compilation, l'exécution des tests unitaires (qui ne doivent pas être oubliés), et production du livrable.<br />Pour ce faire, notre application suivra les préconisations maven et le plugin assembly sera utilisé pour la phase de génération du livrable qui sera sous forme de zip. En outre, ce plugin sera associé à la phase maven d'installation de notre application.<br /><h2>Arborescence du projet</h2><span style="font-family: Comic Sans MS;"><small>foo<br />&nbsp; |-- src<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- main<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- java<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- resources<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- launcher.bat<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- launcher.sh<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- cp.bat<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- README.txt<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- assembly<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- src.xml<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- test <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |-- java<br />&nbsp; |-- pom.xml<br /></small></span><br /><h2>Fichier pom.xml</h2><pre class="brush:xml; wrap-lines: false; auto-links: false"><project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br /> xmlns="http://maven.apache.org/POM/4.0.0"<br /> xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"><br /> &lt;modelVersion>4.0.0&lt;/modelVersion><br /> &lt;artifactId>foo&lt;/artifactId><br /> &lt;groupId>com.xxx&lt;/groupId><br /> <version>1.0-SNAPSHOT</version><br /> <packaging>jar</packaging><br /> <dependencies><br />  <dependency><br />   &lt;groupId>org.testng&lt;/groupId><br />   &lt;artifactId>testng&lt;/artifactId><br />   <version>5.9</version><br />   <classifier>jdk15</classifier><br />   <scope>test</scope><br />  </dependency><br />  <dependency><br />   &lt;groupId>log4j&lt;/groupId><br />   &lt;artifactId>log4j&lt;/artifactId><br />   <version>1.2.15</version><br />  </dependency><br />  ...<br /> </dependencies><br /> <build><br />  &lt;finalName>foo&lt;/finalName><br />  <plugins><br />   <plugin><br />    &lt;artifactId>maven-assembly-plugin&lt;/artifactId><br />    <version>2.2-beta-4</version><br />    <configuration><br />     <descriptors><br />      <descriptor>src/main/assembly/src.xml</descriptor><br />     </descriptors><br />    </configuration><br />    <executions><br />     <execution><br />      <id>make-assembly</id><br />      <phase>install</phase><br />      <goals><br />       <goal>single</goal><br />      </goals><br />     </execution><br />    </executions><br />   </plugin><br />   <plugin><br />    &lt;artifactId>maven-source-plugin&lt;/artifactId><br />    <version>2.1.1</version><br />    <executions><br />     <execution><br />      <phase>package</phase><br />      <goals><br />       <goal>jar</goal><br />      </goals><br />     </execution><br />    </executions><br />   </plugin><br />   <plugin><br />    &lt;artifactId>maven-javadoc-plugin&lt;/artifactId><br />    <version>2.6.1</version><br />    <executions><br />     <execution><br />      <goals><br />       <goal>javadoc</goal><br />      </goals><br />      <phase>package</phase><br />     </execution><br />    </executions><br />   </plugin><br />  </plugins><br /> </build><br /></project></pre><h2>Fichier src.xml</h2><pre class="brush:xml; wrap-lines: false; auto-links: false"><assembly><br /> <formats><br />  <format>zip</format><br /> </formats><br /> &lt;includeBaseDirectory><br />  false<br /> &lt;/includeBaseDirectory><br /> &lt;dependencySets><br />  &lt;dependencySet><br />   <scope>compile</scope><br />   &lt;useProjectArtifact>false&lt;/useProjectArtifact><br />   &lt;useTransitiveDependencies>true&lt;/useTransitiveDependencies><br />   &lt;outputDirectory>lib&lt;/outputDirectory><br />  &lt;/dependencySet><br /> &lt;/dependencySets><br /> &lt;fileSets><br />  &lt;fileSet><br />   <directory>target/site/apidocs</directory><br />   &lt;outputDirectory>api&lt;/outputDirectory><br />   <includes><br />    <include>**</include><br />   </includes><br />  &lt;/fileSet><br /> &lt;/fileSets><br /> <files><br />  <file><br />   <source>src/main/resources/README.txt</source><br />   &lt;destName>README.txt&lt;/destName><br />  </file><br />  <file><br />   <source>target/sources.jar</source><br />   &lt;destName>sources/sources.jar&lt;/destName><br />  </file><br />  <file><br />   <source>src/main/resources/launcher.sh</source><br />   &lt;destName>launcher.sh&lt;/destName><br />   &lt;fileMode>0755&lt;/fileMode><br />  </file><br />  <file><br />   <source>src/main/resources/launcher.bat</source><br />   &lt;destName>launcher.bat&lt;/destName><br />  </file><br />  <file><br />   <source>src/main/resources/cp.bat</source><br />   &lt;destName>cp.bat&lt;/destName><br />  </file><br /> </files><br /></assembly></pre><h2>Fichiers launcher.bat et cp.bat</h2>fichier cp.bat :<br /><pre class="brush:bash; wrap-lines: false; auto-links: false">set CP=%CP%;%1</pre><br />fichier launcher.bat :<br /><pre class="brush:bash; wrap-lines: false; auto-links: false">set TEST_HOME=.<br />set CP=libfor %%i in (%TEST_HOME%\lib\*.jar) do<br />call cp.bat %%i<br />java -classpath %CP% monpackage.ClasseMain </pre><h2>Fichier launcher.sh</h2><pre class="brush:bash; wrap-lines: false; auto-links: false">#!/bin/bash<br />export TEST_HOME=.<br />export TEST_CP=.<br />for i in ${TEST_HOME}/lib/*.jar;<br />&nbsp;&nbsp;&nbsp; do TEST_CP=$i:${TEST_CP}<br />done<br />java -classpath ${TEST_CP}:lib monpackage.ClasseMain</pre><h1>Conclusion</h1>On a donc pu constater que la procédure de production d'un livrable est totalement intégrable avec maven 2 et qu'elle est extrêmement simple et peu consommatrice en temps une fois mise en place. <br />En outre, cela permet de normaliser le livrable et d'être sûr de ne rien oublier d'une version à une autre... alors pourquoi s'en passer?<br />Il est à noter que la problématique est identique avec d'autres outils (ant, graddle, easy-ant, ...) et qu'il est indispensable de prendre en compte cette phase de développement.<br /><h1>Pour aller plus loin...</h1><ul><li><b>Apache Maven</b> de N. De Loof, A. Héritier chez Pearson<br /></li><li><b>Better Builds with Maven</b> : <a href="http://repo.exist.com/dist/maestro/1.7.0/BetterBuildsWithMaven.pdf">http://repo.exist.com/dist/maestro/1.7.0/BetterBuildsWithMaven.pdf</a></li><li> <b>Maven. Definitive Guide</b> : <a href="http://www.sonatype.com/products/maven/documentation/book-defguide">http://www.sonatype.com/products/maven/documentation/book-defguide</a><br /></li></ul><ul><li>Site de maven : <a href="http://maven.apache.org/">http://maven.apache.org/</a></li></ul><ul><li>Présentation de Maven 2 par le BreizhJUG : <a href="http://sites.google.com/a/breizhjug.org/home/2008/Maven">http://sites.google.com/a/breizhjug.org/home/2008/Maven</a></li></ul></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Khanh</div>
<div class='content'>
Concernant le .bat, il est également possible de n&#39;avoir à gérer qu&#39;un seul fichier.<br />Plus d&#39;infos sur le post suivant : <a href="http://blog.soat.fr/2010/05/java-classpath/" rel="nofollow">http://blog.soat.fr/2010/05/java-classpath/</a></div>
</div>
<div class='comment'>
<div class='author'>Sylvain</div>
<div class='content'>
Y a pas à dire, Java c&#39;est quand même une usine à gaz ;-)<br />Passe sur des outils plus simples genre Ruby et tu verras que la vie est plus belle<br /><br />C&#39;était le troll du vendredi avancé au lundi !</div>
</div>
</div>
