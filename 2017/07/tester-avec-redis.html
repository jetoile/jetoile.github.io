
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>

<script type="text/javascript">
    var host = "blog.jetoile.fr";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
</script>

  <meta charset="utf-8">
  <title>Des Tests D'intégration Avec Redis - Jetoile</title>
  <meta name="author" content="Khanh Maudoux">

  <meta content='blog sur Java jee' name='description'/>
  <meta content='jee, java, cloud, nosql' name='keywords'/>
  <meta content='index, follow' name='robots'/>
  <link href='url' rel='canonical'/>

  
  <meta name="description" content="Des Tests D'intégration Avec Redis July 17, 2017 Redis est écrit en C et faire des tests d&#8217;intégration en Java peut s&#8217;avérer compliquer &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://blog.jetoile.fr/2017/07/tester-avec-redis.html">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jetoile" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>

  <script src="/javascripts/monthly_archive.js"></script>
  <!-- font-family: 'Knewave', cursive; -->
<link href='http://fonts.googleapis.com/css?family=Knewave' rel='stylesheet' type='text/css'>
<!-- font-family: 'Cantata One', serif; -->
<link href='http://fonts.googleapis.com/css?family=Cantata+One' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11955429-1']);
    _gaq.push(['_trackPageview']);
    _gaq.push(['_setDomainName','github.io']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Des Tests D'intégration Avec Redis</h1>
        <div class="meta">
          








  



<time datetime="2017-07-17T11:10:30+02:00" pubdate data-updated="true">July 17, 2017</time>  
        </div>
        <p><img src="/images/redis.png" alt="left-small" /> Redis est écrit en C et faire des tests d&#8217;intégration en Java peut s&#8217;avérer compliquer. En outre, le fait que Redis doive être compilé lors de son installation rend les choses encore moins aisées.</p>

<p>Bien sûr, il est possible d&#8217;utiliser Docker ou de l&#8217;installer préalablement sur son poste mais cette deuxième option casse un peu les bonnes pratiques des tests.</p>

<p>Il existe également de nombreux projets permettant de faire des tests avec Redis mais, souvent, les solutions proposées embarquent le binaire de Redis ou on besoin qu&#8217;il soit déjà présent et installer/compiler sur le poste (<a href="https://github.com/kstyrc/embedded-redis,">https://github.com/kstyrc/embedded-redis,</a> <a href="https://github.com/lordofthejars/nosql-unit,">https://github.com/lordofthejars/nosql-unit,</a> <a href="https://github.com/ishiis/redis-unit">https://github.com/ishiis/redis-unit</a>). Les solutions qui intègrent le binaire ne sont malheureusement souvent pas à jour et laisse assez peu la main sur la version.</p>

<p>Pour ceux qui n&#8217;aurait pas envie d&#8217;utiliser Docker, cet article va montrer comment il est possible de piloter programmatiquement l&#8217;installation de Redis afin de permettre les tests d&#8217;intégration.</p>

<!-- more -->


<p>En fait, le code ci-dessous se charge de télécharger Redis et de le compiler dans le répertoire <code>$USER_HOME/.redis</code>. Pour ce faire une tache ant est utilisée car un appel direct à la commande make échoue.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">org.apache.commons.io.FileUtils</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.commons.io.IOUtils</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.tools.ant.BuildException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.tools.ant.DefaultLogger</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.tools.ant.Project</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.apache.tools.ant.ProjectHelper</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.codehaus.plexus.archiver.ArchiverException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.codehaus.plexus.archiver.tar.TarGZipUnArchiver</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.codehaus.plexus.logging.console.ConsoleLogger</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.net.URL</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.nio.file.Path</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">FileUtils</span><span class="o">.</span><span class="na">getFile</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisInstaller</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">RedisInstaller</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">REDIS_PACKAGE_PREFIX</span> <span class="o">=</span> <span class="s">&quot;redis-&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">REDIS_EXECUTABLE_FILE</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;redis-server&quot;</span><span class="o">,</span> <span class="s">&quot;redis-sentinel&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Path</span> <span class="n">REDIS_INSTALLATION_PATH</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;user.home&quot;</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;/.redis&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">downloadUrl</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">version</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">forceCleanupInstallationDirectory</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">tmpDir</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">RedisInstaller</span><span class="o">(</span><span class="n">String</span> <span class="n">version</span><span class="o">,</span> <span class="n">String</span> <span class="n">downloadUrl</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">forceCleanupInstallationDirectory</span><span class="o">,</span> <span class="n">String</span> <span class="n">tmpDir</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">downloadUrl</span> <span class="o">=</span> <span class="n">downloadUrl</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">version</span> <span class="o">=</span> <span class="n">version</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">forceCleanupInstallationDirectory</span> <span class="o">=</span> <span class="n">forceCleanupInstallationDirectory</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">tmpDir</span> <span class="o">=</span> <span class="n">tmpDir</span><span class="o">;</span>
</span><span class='line'>        <span class="n">REDIS_INSTALLATION_PATH</span><span class="o">.</span><span class="na">toFile</span><span class="o">().</span><span class="na">mkdirs</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">File</span> <span class="nf">getExecutableFile</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">fileRelativeToInstallationDir</span><span class="o">(</span><span class="s">&quot;src&quot;</span><span class="o">,</span> <span class="s">&quot;redis-server&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">File</span> <span class="nf">fileRelativeToInstallationDir</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">getFile</span><span class="o">(</span><span class="n">getInstallationDirectory</span><span class="o">(),</span> <span class="n">path</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">File</span> <span class="nf">getInstallationDirectory</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nf">getFile</span><span class="o">(</span><span class="n">REDIS_INSTALLATION_PATH</span><span class="o">.</span><span class="na">toFile</span><span class="o">(),</span> <span class="n">REDIS_PACKAGE_PREFIX</span> <span class="o">+</span> <span class="n">version</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">install</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">forceCleanupInstallationDirectory</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">FileUtils</span><span class="o">.</span><span class="na">forceDelete</span><span class="o">(</span><span class="n">getInstallationDirectory</span><span class="o">());</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">installRedis</span><span class="o">();</span>
</span><span class='line'>        <span class="n">makeRedis</span><span class="o">();</span>
</span><span class='line'>        <span class="n">applyRedisPermissionRights</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">installRedis</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Path</span> <span class="n">downloadedTo</span> <span class="o">=</span> <span class="n">download</span><span class="o">(</span><span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">downloadUrl</span> <span class="o">+</span> <span class="n">REDIS_PACKAGE_PREFIX</span> <span class="o">+</span> <span class="n">version</span> <span class="o">+</span> <span class="s">&quot;.tar.gz&quot;</span><span class="o">));</span>
</span><span class='line'>        <span class="n">install</span><span class="o">(</span><span class="n">downloadedTo</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">File</span> <span class="nf">getAntFile</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">RedisInstaller</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&quot;build.xml&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">File</span> <span class="n">fileOut</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">tmpDir</span><span class="o">,</span> <span class="s">&quot;build.xml&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Writing redis&#39; build.xml to: &quot;</span> <span class="o">+</span> <span class="n">fileOut</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">FileUtils</span><span class="o">.</span><span class="na">openOutputStream</span><span class="o">(</span><span class="n">fileOut</span><span class="o">);</span>
</span><span class='line'>        <span class="n">IOUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">out</span><span class="o">);</span>
</span><span class='line'>        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">fileOut</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">makeRedis</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;&gt; make&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">File</span> <span class="n">makeFilePath</span> <span class="o">=</span> <span class="n">getInstallationDirectory</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">DefaultLogger</span> <span class="n">consoleLogger</span> <span class="o">=</span> <span class="n">getConsoleLogger</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Project</span><span class="o">();</span>
</span><span class='line'>        <span class="n">File</span> <span class="n">buildFile</span> <span class="o">=</span> <span class="n">getAntFile</span><span class="o">();</span>
</span><span class='line'>        <span class="n">project</span><span class="o">.</span><span class="na">setUserProperty</span><span class="o">(</span><span class="s">&quot;ant.file&quot;</span><span class="o">,</span> <span class="n">buildFile</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
</span><span class='line'>        <span class="n">project</span><span class="o">.</span><span class="na">addBuildListener</span><span class="o">(</span><span class="n">consoleLogger</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">fireBuildStarted</span><span class="o">();</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>
</span><span class='line'>            <span class="n">ProjectHelper</span> <span class="n">projectHelper</span> <span class="o">=</span> <span class="n">ProjectHelper</span><span class="o">.</span><span class="na">getProjectHelper</span><span class="o">();</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">addReference</span><span class="o">(</span><span class="s">&quot;ant.projectHelper&quot;</span><span class="o">,</span> <span class="n">projectHelper</span><span class="o">);</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&quot;redisDirectory&quot;</span><span class="o">,</span> <span class="n">makeFilePath</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
</span><span class='line'>            <span class="n">projectHelper</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">project</span><span class="o">,</span> <span class="n">buildFile</span><span class="o">);</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">executeTarget</span><span class="o">(</span><span class="s">&quot;init&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">fireBuildFinished</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BuildException</span> <span class="n">buildException</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">project</span><span class="o">.</span><span class="na">fireBuildFinished</span><span class="o">(</span><span class="n">buildException</span><span class="o">);</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">&quot;!!! Unable to compile redis !!!&quot;</span><span class="o">,</span> <span class="n">buildException</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">DefaultLogger</span> <span class="nf">getConsoleLogger</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">DefaultLogger</span> <span class="n">consoleLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultLogger</span><span class="o">();</span>
</span><span class='line'>        <span class="n">consoleLogger</span><span class="o">.</span><span class="na">setErrorPrintStream</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">);</span>
</span><span class='line'>        <span class="n">consoleLogger</span><span class="o">.</span><span class="na">setOutputPrintStream</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
</span><span class='line'>        <span class="n">consoleLogger</span><span class="o">.</span><span class="na">setMessageOutputLevel</span><span class="o">(</span><span class="n">Project</span><span class="o">.</span><span class="na">MSG_INFO</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">consoleLogger</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Path</span> <span class="nf">download</span><span class="o">(</span><span class="n">URL</span> <span class="n">source</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">File</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">REDIS_INSTALLATION_PATH</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">source</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(!</span><span class="n">target</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Downloading : &quot;</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s">&quot; to &quot;</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">FileUtils</span><span class="o">.</span><span class="na">copyURLToFile</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="n">target</span><span class="o">);</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Download complete&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Download skipped&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="na">toPath</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">install</span><span class="o">(</span><span class="n">Path</span> <span class="n">downloadedFile</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Installing Redis into &quot;</span> <span class="o">+</span> <span class="n">REDIS_INSTALLATION_PATH</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">final</span> <span class="n">TarGZipUnArchiver</span> <span class="n">ua</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TarGZipUnArchiver</span><span class="o">();</span>
</span><span class='line'>            <span class="n">ua</span><span class="o">.</span><span class="na">setSourceFile</span><span class="o">(</span><span class="n">downloadedFile</span><span class="o">.</span><span class="na">toFile</span><span class="o">());</span>
</span><span class='line'>            <span class="n">ua</span><span class="o">.</span><span class="na">enableLogging</span><span class="o">(</span><span class="k">new</span> <span class="n">ConsoleLogger</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;console&quot;</span><span class="o">));</span>
</span><span class='line'>            <span class="n">ua</span><span class="o">.</span><span class="na">setDestDirectory</span><span class="o">(</span><span class="n">REDIS_INSTALLATION_PATH</span><span class="o">.</span><span class="na">toFile</span><span class="o">());</span>
</span><span class='line'>            <span class="n">ua</span><span class="o">.</span><span class="na">extract</span><span class="o">();</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Done&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ArchiverException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Failure : &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">&quot;!!! Unable to download and untar redis !!!&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">applyRedisPermissionRights</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">File</span> <span class="n">binDirectory</span> <span class="o">=</span> <span class="n">getFile</span><span class="o">(</span><span class="n">getInstallationDirectory</span><span class="o">(),</span> <span class="s">&quot;src&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">fn</span> <span class="o">:</span> <span class="n">REDIS_EXECUTABLE_FILE</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">File</span> <span class="n">executableFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">binDirectory</span><span class="o">,</span> <span class="n">fn</span><span class="o">);</span>
</span><span class='line'>            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;Applying executable permissions on &quot;</span> <span class="o">+</span> <span class="n">executableFile</span><span class="o">);</span>
</span><span class='line'>            <span class="n">executableFile</span><span class="o">.</span><span class="na">setExecutable</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Avec le fichier ant <code>build.xml</code> suivant :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;make&quot;</span> <span class="na">default=</span><span class="s">&quot;init&quot;</span> <span class="na">basedir=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;echo</span> <span class="na">message=</span><span class="s">&quot;Redis compilation is starting&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;exec</span> <span class="na">command=</span><span class="s">&quot;make&quot;</span> <span class="na">dir=</span><span class="s">&quot;${redisDirectory}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;echo</span> <span class="na">message=</span><span class="s">&quot;Redis compilation finished&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/target&gt;</span>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ainsi, en wrappant l&#8217;appel dans un builder, il devient facile d&#8217;invoquer l&#8217;installeur.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Data</span>
</span><span class='line'><span class="nd">@Builder</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedRedisInstaller</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">downloadUrl</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">version</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">tmpDir</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">forceCleanupInstallationDirectory</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">RedisInstaller</span> <span class="n">redisInstaller</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">EmbeddedRedisInstaller</span> <span class="nf">install</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">installRedis</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">installRedis</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">redisInstaller</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisInstaller</span><span class="o">(</span><span class="n">version</span><span class="o">,</span> <span class="n">downloadUrl</span><span class="o">,</span> <span class="n">forceCleanupInstallationDirectory</span><span class="o">,</span> <span class="n">tmpDir</span><span class="o">);</span>
</span><span class='line'>        <span class="n">redisInstaller</span><span class="o">.</span><span class="na">install</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">File</span> <span class="nf">getExecutableFile</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">redisInstaller</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Utilisation de l&#8217;installeur :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">EmbeddedRedisInstaller</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="s">&quot;4.0.0&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">downloadUrl</span><span class="o">(</span><span class="s">&quot;http://download.redis.io/releases/&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">forceCleanupInstallationDirectory</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">tmpDir</span><span class="o">(</span><span class="s">&quot;tmp/redis&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>        <span class="o">.</span><span class="na">install</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Enfin, en le couplant, avec le projet <a href="https://github.com/ishiis/redis-unit">redis-unit</a>, il est possible de choisir son mode d&#8217;utilisation tout en rendant configurable les ports :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">EmbeddedRedisInstaller</span> <span class="n">installer</span> <span class="o">=</span> <span class="n">EmbeddedRedisInstaller</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">downloadUrl</span><span class="o">(</span><span class="n">downloadUrl</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">forceCleanupInstallationDirectory</span><span class="o">(</span><span class="n">cleanupInstallation</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">version</span><span class="o">(</span><span class="n">version</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">tmpDir</span><span class="o">(</span><span class="n">tmpDir</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">installer</span><span class="o">.</span><span class="na">install</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="o">|</span> <span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;unable to install redis&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="nl">SERVER:</span>
</span><span class='line'>        <span class="n">redisServer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisServer</span><span class="o">(</span>
</span><span class='line'>                <span class="k">new</span> <span class="n">RedisServerConfig</span><span class="o">.</span><span class="na">ServerBuilder</span><span class="o">(</span><span class="n">masterPort</span><span class="o">)</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>        <span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nl">CLUSTER:</span>
</span><span class='line'>        <span class="n">redisCluster</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisCluster</span><span class="o">(</span>
</span><span class='line'>                <span class="n">slavePorts</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span>
</span><span class='line'>                        <span class="k">new</span> <span class="n">RedisClusterConfig</span><span class="o">.</span><span class="na">ClusterBuilder</span><span class="o">(</span><span class="n">p</span><span class="o">)</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>                <span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">())</span>
</span><span class='line'>        <span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nl">MASTER_SLAVE:</span>
</span><span class='line'>        <span class="n">redisMasterSlave</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisMasterSlave</span><span class="o">(</span>
</span><span class='line'>                <span class="k">new</span> <span class="n">RedisMasterSlaveConfig</span><span class="o">.</span><span class="na">MasterBuilder</span><span class="o">(</span><span class="n">masterPort</span><span class="o">)</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">build</span><span class="o">(),</span>
</span><span class='line'>                <span class="n">slavePorts</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span>
</span><span class='line'>                        <span class="k">new</span> <span class="n">RedisMasterSlaveConfig</span><span class="o">.</span><span class="na">SlaveBuilder</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">masterPort</span><span class="o">)</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>                <span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">())</span>
</span><span class='line'>        <span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nl">SENTINEL:</span>
</span><span class='line'>        <span class="n">redisSentinel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisSentinel</span><span class="o">(</span>
</span><span class='line'>                <span class="k">new</span> <span class="n">RedisMasterSlaveConfig</span><span class="o">.</span><span class="na">MasterBuilder</span><span class="o">(</span><span class="n">masterPort</span><span class="o">)</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                        <span class="o">.</span><span class="na">build</span><span class="o">(),</span>
</span><span class='line'>                <span class="n">slavePorts</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span>
</span><span class='line'>                        <span class="k">new</span> <span class="n">RedisMasterSlaveConfig</span><span class="o">.</span><span class="na">SlaveBuilder</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">masterPort</span><span class="o">)</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>                <span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()),</span>
</span><span class='line'>                <span class="n">sentinelPorts</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span>
</span><span class='line'>                        <span class="k">new</span> <span class="n">RedisSentinelConfig</span><span class="o">.</span><span class="na">SentinelBuilder</span><span class="o">(</span><span class="n">p</span><span class="o">,</span> <span class="n">masterPort</span><span class="o">)</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">redisBinaryPath</span><span class="o">(</span><span class="n">installer</span><span class="o">.</span><span class="na">getExecutableFile</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">())</span>
</span><span class='line'>                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>                <span class="o">).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">())</span>
</span><span class='line'>        <span class="o">);</span>
</span><span class='line'>        <span class="k">break</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Conclusion</h1>

<p>On a pu voir dans cet article comment il était possible simplement d&#8217;utiliser Redis lors de ses tests d&#8217;intégration sans utiliser Docker et tout en pilotant la chose programmatiquement.</p>

<p>Pour retrouver le code, il est disponible à l&#8217;<a href="https://github.com/jetoile/hadoop-unit/tree/master/hadoop-unit-redis">url suivante</a>.</p>

<p>A noter qu&#8217;il a été utilisé dans <a href="https://github.com/jetoile/hadoop-unit">Hadoop-Unit</a> et qu&#8217;il est possible d&#8217;utiliser Redis en test d&#8217;intégration des manière suivantes ( #autopromo ;) ) :</p>

<ul>
<li>En utilisant le démarrage de <a href="https://github.com/jetoile/hadoop-unit/blob/master/hadoop-unit-redis/src/test/java/fr/jetoile/hadoopunit/RedisBootstrapTest.java">manière programmatique</a>:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@BeforeClass</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">BootstrapException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">HadoopBootstrap</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">startAll</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@AfterClass</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">tearDown</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">BootstrapException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">HadoopBootstrap</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">stopAll</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testStartAndStopServerMode</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Jedis</span> <span class="n">jedis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jedis</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">,</span> <span class="mi">6379</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Assert</span><span class="o">.</span><span class="na">assertNotNull</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">info</span><span class="o">());</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">jedis</span><span class="o">.</span><span class="na">info</span><span class="o">());</span>
</span><span class='line'>    <span class="n">jedis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>avec le pom suivant :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>fr.jetoile.hadoop<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>hadoop-unit-redis<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>2.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>redis.clients<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>jedis<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>2.9.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependency&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>et le fichier de configuration <code>hadoop-unit-default.properties</code> suivant:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Redis
</span><span class='line'>redis.port=6379
</span><span class='line'>redis.download.url=http://download.redis.io/releases/
</span><span class='line'>redis.version=4.0.0
</span><span class='line'>redis.cleanup.installation=false
</span><span class='line'>redis.temp.dir=/tmp/redis
</span><span class='line'>redis.type=SERVER
</span><span class='line'>#redis.type=CLUSTER
</span><span class='line'>#redis.type=MASTER_SLAVE
</span><span class='line'>#redis.type=SENTINEL
</span><span class='line'>#redis.slave.ports=6380
</span><span class='line'>#redis.sentinel.ports=36479,36480,36481,36482,36483</span></code></pre></td></tr></table></div></figure>


<ul>
<li>En utilisant le plugin maven en <a href="https://github.com/jetoile/hadoop-unit/tree/master/sample/redis">phase de pré-integration</a>:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>hadoop-unit-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>fr.jetoile.hadoop<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>${hadoop-unit.version}<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>    <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>        <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>            <span class="nt">&lt;id&gt;</span>start<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>            <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>                <span class="nt">&lt;goal&gt;</span>embedded-start<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>            <span class="nt">&lt;phase&gt;</span>pre-integration-test<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>    <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;components&gt;</span>
</span><span class='line'>            <span class="nt">&lt;componentArtifact</span> <span class="na">implementation=</span><span class="s">&quot;fr.jetoile.hadoopunit.ComponentArtifact&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;componentName&gt;</span>REDIS<span class="nt">&lt;/componentName&gt;</span>
</span><span class='line'>                <span class="nt">&lt;artifact&gt;</span>fr.jetoile.hadoop:hadoop-unit-redis:${hadoop-unit.version}<span class="nt">&lt;/artifact&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/componentArtifact&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/components&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'><span class="nt">&lt;/plugin&gt;</span>
</span></code></pre></td></tr></table></div></figure>



<footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Khanh Maudoux</span></span>

      </p>
      <p class="meta">
      








  



<time datetime="2017-07-17T11:10:30+02:00" pubdate data-updated="true">July 17, 2017</time> in 

<span class="categories">
  
    <a class='category' href='/blog/categories/redis/'>Redis</a>, <a class='category' href='/blog/categories/test/'>Test</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://blog.jetoile.fr/2017/07/tester-avec-redis.html" data-via="jetoile" data-counturl="https://blog.jetoile.fr/2017/07/tester-avec-redis.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
</footer>

<!--
<section>
<h1>Comments</h1>
<script>
var idcomments_acct = '1a2a89d3b135fb1f774e938fd286d920';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript' src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>

</section>
-->


  <section>
    <h1>Comments</h1>

    <!--
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jetoile'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
-->

<div id="disqus_thread"></div>
  

<script type="text/javascript">
      var disqus_shortname = 'jetoile';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://blog.jetoile.fr/2017/07/tester-avec-redis.html';
        var disqus_url = 'https://blog.jetoile.fr/2017/07/tester-avec-redis.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

  </section>


      </div>
    </div>
  </div>



</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <a class="pull-center" href="/" title="Home">Home</a>
    </div>
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/2017/07/tester-avec-elasticsearch.html" title="Previous Post: Des tests d'intégration avec Elasticsearch">&laquo; Previous: Des tests d'intégration avec Elasticsearch</a>
        

        
      </div>
    </div>
  </div>
</div>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<script type="text/javascript">
  window.___gcfg = {lang: 'fr'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/platform.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div id='footer-shadow'></div>
<!--//please give me a respect for keep these credits line -->
<div class='credits'>
<div align='center'>

<table style="border:none;border-spacing: 20px;border-collapse: separate;">
<tr style="border:none">
<td style="border:none">
<a href="http://twitter.com/jetoile" class="twitter-follow-button" data-show-count="false" data-lang="fr">Follow @jetoile</a>
<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
</td>
<td style="border:none">
<a href="https://plus.google.com/u/0/114765959876500830478/posts?prsrc=3" style="text-decoration: none; color: #333;"><div style="display: inline-block;"><span style="float: left; font: bold 13px/16px arial,sans-serif; margin-right: 4px; margin-top: 7px;">khanh</span><span style="float: left; font: 13px/16px arial,sans-serif; margin-right: 11px; margin-top: 7px;">on</span><div style="float: left;"><img src="/images/gplus-32.png" width="32" height="32" style="border: 0;"/></div><div style="clear: both"></div></div></a>
</td>
<td style="border:none">
<a href="http://fr.linkedin.com/pub/khanh-tuong-maudoux/19/92b/11b"><img src="/images/btn_profile_bluetxt_8
0x15_fr_FR.png" width="80" height="15" border="0" alt="Voir le profil de Khanh Tuong Maudoux sur LinkedIn" /></a>
</td>
</tr>
</table>


<img alt='Jetoile' height='50' src='/images/logoJetoile_v51.png' style='border-width:0; vertical-align: middle' width='180'/>
<p>&#169; 2011 <a href='http://blog.jetoile.fr/'>Je toile ou j* au choix...</a> - Khanh Maudoux</p>
<a href='http://creativecommons.org/licenses/by/4.0/' rel='license'><img alt='Licence Creative Commons' src='/images/creative_common88x31.png' style='border-width:0'/></a> Cette œuvre de <a href='http://blog.jetoile.fr' property='cc:attributionName' rel='cc:attributionURL' xmlns:cc='http://creativecommons.org/ns#'>http://blog.jetoile.fr</a> est mise à disposition selon les termes de la <a href='http://creativecommons.org/licenses/by/4.0/' rel='license'>licence Creative Commons Attribution 4.0 International</a>.
<!--img alt='Creative Commons License' src='http://i.creativecommons.org/l/by/2.0/fr/88x31.png' style='border-width:0; vertical-align: middle;'/> <small>Sauf mention contraire, le contenu de ce blog est mis à disposition selon les termes de la licence <a href='http://creativecommons.org/licenses/by/2.0/fr/'>Creative Commons Attribution 2.0 License</a>.</small-->
<br/>
<small>Powered by <a href="http://octopress.org">Octopress</a><br/>
</small>
</div>
</div>


    </div>
  </div>
</footer>

  </body>
</html>
