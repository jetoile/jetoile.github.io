<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.83.1" />

  <title>Précompiler ses jsp &middot; Jetoile</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://blog.jetoile.fr/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://blog.jetoile.fr/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://blog.jetoile.fr/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://blog.jetoile.fr/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://blog.jetoile.fr/css/my.css">
    
  
  
    
        <script src="https://blog.jetoile.fr/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://blog.jetoile.fr/">Jetoile</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://blog.jetoile.fr/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://blog.jetoile.fr/post"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://blog.jetoile.fr/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://blog.jetoile.fr/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://blog.jetoile.fr/hadoop-unit"><i class='fa fa-list fa-fw'></i>Hadoop Unit</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/jetoile" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/jetoile" rel="me" target="_blank"><i class="fab fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/khanh-tuong-maudoux-11b92b19" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/jetoile" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small><a href='http://creativecommons.org/licenses/by/4.0/' rel='license'><img alt='Licence Creative Commons' src='https://blog.jetoile.fr/images/creative_common88x31.png' style='border-width:0'/></a></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Précompiler ses jsp</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>05 Nov 2012</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://blog.jetoile.fr/tags/maven">maven</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://blog.jetoile.fr/tags/java">java</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://blog.jetoile.fr/tags/ant">ant</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://blog.jetoile.fr/tags/int%C3%A9gration-continue">intégration continue</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://blog.jetoile.fr/tags/jsp">jsp</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://blog.jetoile.fr/tags/tomcat">tomcat</a>
    
  </div>
  
  

</div>

  <p><img src="http://1.bp.blogspot.com/-9Hhc_8qdf1Y/UIhESh6Ls9I/AAAAAAAAAso/2fJIJUvqvIo/s1600/title.png" alt="left-small"></p>
<p>Parce qu&rsquo;il est parfois nécessaire de valider ses jsp, cet article fera un petit retour sur comment cela peut être mis en oeuvre.</p>
<p>Oui, je sais, les jsp c&rsquo;est <em>has been</em> me diront certains&hellip; Cependant, il ne faut pas oublier que dans le monde Java, cela reste une des technologies indispensables quelle que soit le framework utilisé (j&rsquo;entends par là dans le cas où les pages sont rendus dynamiquement par une technologie java).</p>
<p>Ayant eu récemment à intégrer une phase de validation des jsp maintenus principalement par des équipes &ldquo;front&rdquo; n&rsquo;ayant que peu de connaissance en Java, ce rapide retour d&rsquo;expérience tentera d&rsquo;exposer les quelques points qui ont pu me poser problème et en l&rsquo;occurrence les quelques-unes des différentes solutions possibles pour traiter ce point.</p>
<p>Aussi, dans une première partie, je présenterai le contexte, pour ensuite aborder trois des solutions possibles (et relativement récentes car il en existe plusieurs dans différentes versions&hellip;) pour valider les jsp.</p>
<!-- more -->
<p>#Contexte</p>
<p>Cette partie présentera le contexte de l&rsquo;application web où j&rsquo;ai eu à mettre en oeuvre une validation des jsp. Le but de l&rsquo;application web étant d&rsquo;offrir aux utilisateurs un site web, elle disposait de nombreuses pages jsp.</p>
<p>Coté organisation, les équipes étaient divisées en 2 :</p>
<ul>
<li>l&rsquo;équipe Java dont la charge était de fournir toute la partie controleur/modèle ainsi qu&rsquo;un premier jet de la couche présentation au travers de jsp réduites à leurs plus simples appareils,</li>
<li>l&rsquo;équipe front dont la charge était de décorer les pages jsp avec toutes les parties CSS et Javascript.</li>
</ul>
<p>Coté technologie, le site tournait sur un Tomcat 6 avec du Java 7. Pour la partie build/packaging, Maven 3 était de la partie et, pour la partie usine logicielle, un serveur Jenkins.</p>
<p>Le site étant assez vieux, il s&rsquo;appuyait sur un framework de présentation maison ainsi que sur un framework de décoration : <a href="http://wiki.sitemesh.org/display/sitemesh/Home">Sitemesh 2</a>.</p>
<p>La partie compilation des jsp ayant pour objectif de prévenir au plus tôt l&rsquo;équipe de développeurs front de la non conformité (au sens compilation du terme) d&rsquo;une page jsp, le but était de créer un job Jenkins dont la seule tâche était de compiler les jsp.</p>
<p>Embarquer les jsp pré-compilés dans le livrable final (ie. le war) n&rsquo;était donc pas la cible.</p>
<p>#Mise en oeuvre</p>
<p>##jspc-maven-plugin</p>
<p>###Mise en oeuvre</p>
<p>Dans ma première tentative de mise en oeuvre, j&rsquo;ai utilisé le goal compile du plugin <strong>jspc-maven-plugin</strong> pour tomcat6 :</p>
<ul>
<li>
<p><a href="http://mojo.codehaus.org/jspc-maven-plugin/usage.html">http://mojo.codehaus.org/jspc-maven-plugin/usage.html</a></p>
</li>
<li>
<p><a href="http://mojo.codehaus.org/jspc/jspc-maven-plugin/usage.html">http://mojo.codehaus.org/jspc/jspc-maven-plugin/usage.html</a></p>
</li>
</ul>
<p>Rien de bien compliqué si on regarde la documentation officielle puisqu&rsquo;il n&rsquo;y a cas déclarer dans le pom les informations suivantes :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;profiles&gt;</span>
    <span style="color:#f92672">&lt;profile&gt;</span>
        <span style="color:#f92672">&lt;id&gt;</span>jsp-compile-jspc-maven<span style="color:#f92672">&lt;/id&gt;</span>
        <span style="color:#f92672">&lt;build&gt;</span>
            <span style="color:#f92672">&lt;plugins&gt;</span>
                <span style="color:#f92672">&lt;plugin&gt;</span>
                    <span style="color:#f92672">&lt;groupId&gt;</span>org.codehaus.mojo<span style="color:#f92672">&lt;/groupId&gt;</span>
                    <span style="color:#f92672">&lt;artifactId&gt;</span>jspc-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
                    <span style="color:#f92672">&lt;version&gt;</span>2.0-alpha-3<span style="color:#f92672">&lt;/version&gt;</span>
                    <span style="color:#f92672">&lt;executions&gt;</span>
                        <span style="color:#f92672">&lt;execution&gt;</span>
                            <span style="color:#f92672">&lt;id&gt;</span>pre-compile-jsp<span style="color:#f92672">&lt;/id&gt;</span>
                            <span style="color:#f92672">&lt;goals&gt;</span>
                                <span style="color:#f92672">&lt;goal&gt;</span>compile<span style="color:#f92672">&lt;/goal&gt;</span>
                            <span style="color:#f92672">&lt;/goals&gt;</span>
                            <span style="color:#f92672">&lt;phase&gt;</span>test<span style="color:#f92672">&lt;/phase&gt;</span>
                            <span style="color:#f92672">&lt;configuration&gt;</span>
                            <span style="color:#f92672">&lt;/configuration&gt;</span>
                        <span style="color:#f92672">&lt;/execution&gt;</span>
                    <span style="color:#f92672">&lt;/executions&gt;</span>
                    <span style="color:#f92672">&lt;dependencies&gt;</span>
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>org.codehaus.mojo.jspc<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>jspc-compiler-tomcat6<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>2.0-alpha-3<span style="color:#f92672">&lt;/version&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
 
                    <span style="color:#f92672">&lt;/dependencies&gt;</span>
                <span style="color:#f92672">&lt;/plugin&gt;</span>
 
            <span style="color:#f92672">&lt;/plugins&gt;</span>
        <span style="color:#f92672">&lt;/build&gt;</span>
 
    <span style="color:#f92672">&lt;/profile&gt;</span>
    ...
<span style="color:#f92672">&lt;/profiles&gt;</span>    
...
<span style="color:#f92672">&lt;build&gt;</span>
    <span style="color:#f92672">&lt;plugins&gt;</span>
    <span style="color:#f92672">&lt;plugin&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>maven-compiler-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.3.2<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;configuration&gt;</span>
            <span style="color:#f92672">&lt;target&gt;</span>1.7<span style="color:#f92672">&lt;/target&gt;</span>
            <span style="color:#f92672">&lt;source&gt;</span>1.7<span style="color:#f92672">&lt;/source&gt;</span>
        <span style="color:#f92672">&lt;/configuration&gt;</span>
    <span style="color:#f92672">&lt;/plugin&gt;</span>
    <span style="color:#f92672">&lt;/plugins&gt;</span>
<span style="color:#f92672">&lt;/build&gt;</span>
 
<span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>opensymphony<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>sitemesh<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.4.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
 
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>jstl<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>jstl<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><p>On constate que les dépendances à sitemesh ainsi qu&rsquo;à la jstl ont été déclaré afin de fournir à la compilation des jsp le nécessaire. De même, il est important de noter que le plugin <strong>jspc-maven-plugin</strong> doit obligatoirement fournir un <strong>jspc-compiler</strong> qui est spécifique à la version de tomcat utilisé.</p>
<p>Malheureusement, après un petit coup de :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mvn test -Pjsp-compile-jspc-maven
</code></pre></div><p>on peut se rendre compte que, si les jsp contiennent des scritlets avec du code Java 5 telle qu&rsquo;une petite enum (oui, je sais, les scriptlets c&rsquo;est mal&hellip; mais, dans mon cas, c&rsquo;était pour tester&hellip;), on se fait joliment insulté&hellip; :
<img src="http://2.bp.blogspot.com/-E1qsxbHRQfI/UIgT-ax6M_I/AAAAAAAAArY/p1RBmt2us0o/s1600/error01.png" alt="medium"></p>
<p>Après quelques recherches, je suis tombé sur ce lien :
<a href="http://stackoverflow.com/questions/7156953/maven-jspc-should-use-external-jsp-files">http://stackoverflow.com/questions/7156953/maven-jspc-should-use-external-jsp-files</a></p>
<p>Cool, peut-on se dire, il suffit de mettre la configuration de compilation en 1.5&hellip; mais ma cible n&rsquo;était-elle pas le jdk 1.7?</p>
<p>Heureusement, le lien suivant semble annoncé que cela a été corrigé&hellip;
<a href="http://jira.codehaus.org/browse/MJSPC-54">http://jira.codehaus.org/browse/MJSPC-54</a></p>
<p>Malheureusement, la version actuelle ne semble pas bénéficier de ces modifications (la alpha-3 date de 2008 et le ticket a été mis à jour en 2012&hellip;). Ne reste donc plus qu&rsquo;à récupérer le code source du svn et à le recompiler&hellip; (<code>svn checkout https://svn.codehaus.org/mojo/trunk/mojo/jspc</code>).</p>
<p>Donc, après avoir modifié dans mon pom les informations adéquates, je lance la précompilation et là&hellip; miracle&hellip;!!! Ca marche ;-)</p>
<p>Au final, on aura donc le code suivant :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;profiles&gt;</span>
    <span style="color:#f92672">&lt;profile&gt;</span>
        <span style="color:#f92672">&lt;id&gt;</span>jsp-compile-jspc-maven<span style="color:#f92672">&lt;/id&gt;</span>
        <span style="color:#f92672">&lt;build&gt;</span>
            <span style="color:#f92672">&lt;plugins&gt;</span>
                <span style="color:#f92672">&lt;plugin&gt;</span>
                    <span style="color:#f92672">&lt;groupId&gt;</span>org.codehaus.mojo<span style="color:#f92672">&lt;/groupId&gt;</span>
                    <span style="color:#f92672">&lt;artifactId&gt;</span>jspc-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
                    <span style="color:#f92672">&lt;version&gt;</span>2.0-alpha-4-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
                    <span style="color:#f92672">&lt;executions&gt;</span>
                        <span style="color:#f92672">&lt;execution&gt;</span>
                            <span style="color:#f92672">&lt;id&gt;</span>pre-compile-jsp<span style="color:#f92672">&lt;/id&gt;</span>
                            <span style="color:#f92672">&lt;goals&gt;</span>
                                <span style="color:#f92672">&lt;goal&gt;</span>compile<span style="color:#f92672">&lt;/goal&gt;</span>
                            <span style="color:#f92672">&lt;/goals&gt;</span>
                            <span style="color:#f92672">&lt;phase&gt;</span>test<span style="color:#f92672">&lt;/phase&gt;</span>
                            <span style="color:#f92672">&lt;configuration&gt;</span>
                                <span style="color:#f92672">&lt;source&gt;</span>1.7<span style="color:#f92672">&lt;/source&gt;</span>
                                <span style="color:#f92672">&lt;target&gt;</span>1.7<span style="color:#f92672">&lt;/target&gt;</span>
                            <span style="color:#f92672">&lt;/configuration&gt;</span>
                        <span style="color:#f92672">&lt;/execution&gt;</span>
                    <span style="color:#f92672">&lt;/executions&gt;</span>
                    <span style="color:#f92672">&lt;dependencies&gt;</span>
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>org.codehaus.mojo.jspc<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>jspc-compiler-tomcat6<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>2.0-alpha-4-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
 
                    <span style="color:#f92672">&lt;/dependencies&gt;</span>
                <span style="color:#f92672">&lt;/plugin&gt;</span>
 
            <span style="color:#f92672">&lt;/plugins&gt;</span>
        <span style="color:#f92672">&lt;/build&gt;</span>
 
    <span style="color:#f92672">&lt;/profile&gt;</span>
    ...
<span style="color:#f92672">&lt;/profiles&gt;</span>    
...
<span style="color:#f92672">&lt;build&gt;</span>
    <span style="color:#f92672">&lt;plugins&gt;</span>
    <span style="color:#f92672">&lt;plugin&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>maven-compiler-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.3.2<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;configuration&gt;</span>
            <span style="color:#f92672">&lt;target&gt;</span>1.7<span style="color:#f92672">&lt;/target&gt;</span>
            <span style="color:#f92672">&lt;source&gt;</span>1.7<span style="color:#f92672">&lt;/source&gt;</span>
        <span style="color:#f92672">&lt;/configuration&gt;</span>
    <span style="color:#f92672">&lt;/plugin&gt;</span>
    <span style="color:#f92672">&lt;/plugins&gt;</span>
<span style="color:#f92672">&lt;/build&gt;</span>
 
<span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>opensymphony<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>sitemesh<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.4.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
 
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>jstl<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>jstl<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><p>###Conclusion</p>
<p>Au final, ce plugin m&rsquo;aura bien fait suer (et là, je n&rsquo;ai fait qu&rsquo;un rapide condenser de mes recherches et de mes galères - modification des pom en cascade, recherche internet, &hellip;), mais bon&hellip; la solution est fonctionnelle même si elle demande une petite recompilation du plugin.</p>
<p>Cependant, le plugin <strong>jspc-maven-plugin</strong> ne propose pas (si j&rsquo;ai bien regardé le code source) d&rsquo;exclure certaines pages de la compilation, chose qui m&rsquo;était nécessaire&hellip; :'(</p>
<p>Du coup, cette solution n&rsquo;a pas été retenue&hellip;</p>
<p>##jsp-compile-maven-jetty</p>
<p>###Mise en oeuvre</p>
<p>Dans cette deuxième tentative de mise en oeuvre, j&rsquo;ai utilisé le goal <code>jspc</code> du plugin <strong>jsp-compile-maven-plugin</strong>. On peut se demander pourquoi choisir le plugin Jetty alors que la cible était Tomcat. La réponse est que, vu que ce qui m&rsquo;intéressait était la partie compilation pure et non la partie packaging, cela m&rsquo;était égal.</p>
<p>Pour mettre en place, ce plugin, il suffit de suivre la documentation officielle :
<a href="http://docs.codehaus.org/display/JETTY/Maven+Jetty+Jspc+Plugin">http://docs.codehaus.org/display/JETTY/Maven+Jetty+Jspc+Plugin</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;profiles&gt;</span>
    <span style="color:#f92672">&lt;profile&gt;</span>
        <span style="color:#f92672">&lt;id&gt;</span>jsp-compile-maven-jetty<span style="color:#f92672">&lt;/id&gt;</span>
        <span style="color:#f92672">&lt;build&gt;</span>
            <span style="color:#f92672">&lt;plugins&gt;</span>
                <span style="color:#f92672">&lt;plugin&gt;</span>
                    <span style="color:#f92672">&lt;groupId&gt;</span>org.mortbay.jetty<span style="color:#f92672">&lt;/groupId&gt;</span>
                    <span style="color:#f92672">&lt;artifactId&gt;</span>jetty-jspc-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
                    <span style="color:#f92672">&lt;version&gt;</span>8.1.7.v20120910<span style="color:#f92672">&lt;/version&gt;</span>
                    <span style="color:#f92672">&lt;executions&gt;</span>
                        <span style="color:#f92672">&lt;execution&gt;</span>
                            <span style="color:#f92672">&lt;id&gt;</span>pre-compile-jsp<span style="color:#f92672">&lt;/id&gt;</span>
                            <span style="color:#f92672">&lt;goals&gt;</span>
                                <span style="color:#f92672">&lt;goal&gt;</span>jspc<span style="color:#f92672">&lt;/goal&gt;</span>
                            <span style="color:#f92672">&lt;/goals&gt;</span>
                            <span style="color:#f92672">&lt;phase&gt;</span>test<span style="color:#f92672">&lt;/phase&gt;</span>
                            <span style="color:#f92672">&lt;configuration&gt;</span>
                                <span style="color:#f92672">&lt;includes/&gt;</span>
                                <span style="color:#f92672">&lt;excludes/&gt;</span>
                                <span style="color:#f92672">&lt;verbose&gt;</span>true<span style="color:#f92672">&lt;/verbose&gt;</span>
                            <span style="color:#f92672">&lt;/configuration&gt;</span>
                        <span style="color:#f92672">&lt;/execution&gt;</span>
                    <span style="color:#f92672">&lt;/executions&gt;</span>
                <span style="color:#f92672">&lt;/plugin&gt;</span>
 
            <span style="color:#f92672">&lt;/plugins&gt;</span>
        <span style="color:#f92672">&lt;/build&gt;</span>
 
    <span style="color:#f92672">&lt;/profile&gt;</span>
    ...
<span style="color:#f92672">&lt;/profiles&gt;</span>    
...
<span style="color:#f92672">&lt;build&gt;</span>
    <span style="color:#f92672">&lt;plugins&gt;</span>
    <span style="color:#f92672">&lt;plugin&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>maven-compiler-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.3.2<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;configuration&gt;</span>
            <span style="color:#f92672">&lt;target&gt;</span>1.7<span style="color:#f92672">&lt;/target&gt;</span>
            <span style="color:#f92672">&lt;source&gt;</span>1.7<span style="color:#f92672">&lt;/source&gt;</span>
        <span style="color:#f92672">&lt;/configuration&gt;</span>
    <span style="color:#f92672">&lt;/plugin&gt;</span>
    <span style="color:#f92672">&lt;/plugins&gt;</span>
<span style="color:#f92672">&lt;/build&gt;</span>
 
<span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>opensymphony<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>sitemesh<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.4.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
 
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>jstl<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>jstl<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>        
</code></pre></div><p>Malheureusement, même en épluchant la documentation et le code source, on constate qu&rsquo;il n&rsquo;est pas possible de spécifier la version du compilateur.</p>
<p>Aussi, avec mon code de test qui utilise de superbes &ldquo;switch case&rdquo; avec des String seulement disponible à partir de Java 7, j&rsquo;obtiens le résultat suivant :
<img src="http://2.bp.blogspot.com/-MM9hVOZq5sg/UIgxyuqIjFI/AAAAAAAAAsA/Y_9ELLHlMM0/s1600/error02.png" alt="medium"></p>
<p>En effet, après analyses (si je ne me suis pas fourvoyé&hellip;), le code source (<a href="git://git.codehaus.org/jetty-project.git">git://git.codehaus.org/jetty-project.git</a>) ne positionne pas le <code>compilerTarget</code> sur <strong>JspC</strong> et donc, à part hacker le plugin, impossible de surmonter ce manque&hellip;</p>
<p>###Conclusion</p>
<p>On a vu que le plugin <strong>jetty-jspc-maven-plugin</strong> était très simple à mettre en oeuvre mais qu&rsquo;il manquait quelques fonctionnalités comme la possibilité de compiler avec une version supérieure au jdk 1.5.</p>
<p>Du coup, cette solution n&rsquo;a pas été retenue&hellip;</p>
<p>##Ant</p>
<p>###Mise en oeuvre</p>
<p>Dans cette troisième tentative de mise en oeuvre, j&rsquo;ai gentiment suivi les préconisations présentes sur le site de Tomcat pour précompiler les jsp (<a href="http://tomcat.apache.org/tomcat-6.0-doc/jasper-howto.html">http://tomcat.apache.org/tomcat-6.0-doc/jasper-howto.html</a>) :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;profiles&gt;</span>
    <span style="color:#f92672">&lt;profile&gt;</span>
        <span style="color:#f92672">&lt;id&gt;</span>jsp-compile-ant<span style="color:#f92672">&lt;/id&gt;</span>
        <span style="color:#f92672">&lt;build&gt;</span>
            <span style="color:#f92672">&lt;plugins&gt;</span>
                <span style="color:#f92672">&lt;plugin&gt;</span>
                    <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
                    <span style="color:#f92672">&lt;artifactId&gt;</span>maven-antrun-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
                    <span style="color:#f92672">&lt;version&gt;</span>1.6<span style="color:#f92672">&lt;/version&gt;</span>
                    <span style="color:#f92672">&lt;executions&gt;</span>
                        <span style="color:#f92672">&lt;execution&gt;</span>
                            <span style="color:#f92672">&lt;id&gt;</span>pre-compile-jsp<span style="color:#f92672">&lt;/id&gt;</span>
                            <span style="color:#f92672">&lt;phase&gt;</span>test<span style="color:#f92672">&lt;/phase&gt;</span>
                            <span style="color:#f92672">&lt;configuration&gt;</span>
                                <span style="color:#f92672">&lt;target</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;pre-compile-jsp&#34;</span><span style="color:#f92672">&gt;</span>
                                    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;maven.dependencies.classpath&#34;</span> <span style="color:#a6e22e">refid=</span><span style="color:#e6db74">&#34;maven.test.classpath&#34;</span><span style="color:#f92672">/&gt;</span>
                                    <span style="color:#f92672">&lt;ant</span> <span style="color:#a6e22e">antfile=</span><span style="color:#e6db74">&#34;${basedir}/build.xml&#34;</span><span style="color:#f92672">&gt;</span>
                                        <span style="color:#f92672">&lt;target</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;all&#34;</span><span style="color:#f92672">/&gt;</span>
                                    <span style="color:#f92672">&lt;/ant&gt;</span>
                                <span style="color:#f92672">&lt;/target&gt;</span>
                            <span style="color:#f92672">&lt;/configuration&gt;</span>
                            <span style="color:#f92672">&lt;goals&gt;</span>
                                <span style="color:#f92672">&lt;goal&gt;</span>run<span style="color:#f92672">&lt;/goal&gt;</span>
                            <span style="color:#f92672">&lt;/goals&gt;</span>
                        <span style="color:#f92672">&lt;/execution&gt;</span>
                    <span style="color:#f92672">&lt;/executions&gt;</span>
                    <span style="color:#f92672">&lt;dependencies&gt;</span>
                        <span style="color:#75715e">&lt;!-- http://docs.codehaus.org/display/MAVENUSER/Running+ant+tasks+that+use+the+JDK --&gt;</span>
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>com.sun<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>tools<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>1.6.0<span style="color:#f92672">&lt;/version&gt;</span>
                            <span style="color:#f92672">&lt;scope&gt;</span>system<span style="color:#f92672">&lt;/scope&gt;</span>
                            <span style="color:#f92672">&lt;systemPath&gt;</span>${java.home}/../lib/tools.jar<span style="color:#f92672">&lt;/systemPath&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
 
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.tomcat<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>jasper<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>6.0.35<span style="color:#f92672">&lt;/version&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
 
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.tomcat<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>jsp-api<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>6.0.35<span style="color:#f92672">&lt;/version&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
 
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>jstl<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>jstl<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>1.2<span style="color:#f92672">&lt;/version&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
 
                        <span style="color:#f92672">&lt;dependency&gt;</span>
                            <span style="color:#f92672">&lt;groupId&gt;</span>opensymphony<span style="color:#f92672">&lt;/groupId&gt;</span>
                            <span style="color:#f92672">&lt;artifactId&gt;</span>sitemesh<span style="color:#f92672">&lt;/artifactId&gt;</span>
                            <span style="color:#f92672">&lt;version&gt;</span>2.4.2<span style="color:#f92672">&lt;/version&gt;</span>
                        <span style="color:#f92672">&lt;/dependency&gt;</span>
                    <span style="color:#f92672">&lt;/dependencies&gt;</span>
                <span style="color:#f92672">&lt;/plugin&gt;</span>
 
            <span style="color:#f92672">&lt;/plugins&gt;</span>
        <span style="color:#f92672">&lt;/build&gt;</span>
 
        <span style="color:#f92672">&lt;dependencies&gt;</span>
            <span style="color:#f92672">&lt;dependency&gt;</span>
                <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.tomcat<span style="color:#f92672">&lt;/groupId&gt;</span>
                <span style="color:#f92672">&lt;artifactId&gt;</span>jasper<span style="color:#f92672">&lt;/artifactId&gt;</span>
                <span style="color:#f92672">&lt;version&gt;</span>6.0.35<span style="color:#f92672">&lt;/version&gt;</span>
                <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
            <span style="color:#f92672">&lt;/dependency&gt;</span>
 
            <span style="color:#f92672">&lt;dependency&gt;</span>
                <span style="color:#f92672">&lt;groupId&gt;</span>opensymphony<span style="color:#f92672">&lt;/groupId&gt;</span>
                <span style="color:#f92672">&lt;artifactId&gt;</span>sitemesh<span style="color:#f92672">&lt;/artifactId&gt;</span>
                <span style="color:#f92672">&lt;version&gt;</span>2.4.2<span style="color:#f92672">&lt;/version&gt;</span>
                <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
            <span style="color:#f92672">&lt;/dependency&gt;</span>
 
        <span style="color:#f92672">&lt;/dependencies&gt;</span>
    <span style="color:#f92672">&lt;/profile&gt;</span>
    ...
<span style="color:#f92672">&lt;/profiles&gt;</span>    
...
<span style="color:#f92672">&lt;build&gt;</span>
    <span style="color:#f92672">&lt;plugins&gt;</span>
    <span style="color:#f92672">&lt;plugin&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>maven-compiler-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.3.2<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;configuration&gt;</span>
            <span style="color:#f92672">&lt;target&gt;</span>1.7<span style="color:#f92672">&lt;/target&gt;</span>
            <span style="color:#f92672">&lt;source&gt;</span>1.7<span style="color:#f92672">&lt;/source&gt;</span>
        <span style="color:#f92672">&lt;/configuration&gt;</span>
    <span style="color:#f92672">&lt;/plugin&gt;</span>
    <span style="color:#f92672">&lt;/plugins&gt;</span>
<span style="color:#f92672">&lt;/build&gt;</span>
 
<span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>opensymphony<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>sitemesh<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>2.4.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
 
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>jstl<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>jstl<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>        
</code></pre></div><p>avec le fichier <code>build.xml</code> suivant :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
 
<span style="color:#f92672">&lt;project</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;Webapp Precompilation&#34;</span> <span style="color:#a6e22e">default=</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#a6e22e">basedir=</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">&gt;</span>
 
 
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;webapp.path&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${basedir}/src/main/webapp&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jsp.dest.compile&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${basedir}/target/jsp-generated&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jsp.dest&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${basedir}/target/jsp&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#75715e">&lt;!--&lt;property name=&#34;tomcat.home&#34; value=&#34;/opt/apache-tomcat-7.0.23&#34;/&gt;--&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;tomcat.home&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;/usr/local/tomcat60&#34;</span><span style="color:#f92672">/&gt;</span>
 
    <span style="color:#f92672">&lt;import</span> <span style="color:#a6e22e">file=</span><span style="color:#e6db74">&#34;${tomcat.home}/bin/catalina-tasks.xml&#34;</span><span style="color:#f92672">/&gt;</span>
 
    <span style="color:#f92672">&lt;target</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jspc&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;jasper</span>
                <span style="color:#a6e22e">validateXml=</span><span style="color:#e6db74">&#34;false&#34;</span>
                <span style="color:#a6e22e">uriroot=</span><span style="color:#e6db74">&#34;${webapp.path}&#34;</span>
                <span style="color:#a6e22e">webXmlFragment=</span><span style="color:#e6db74">&#34;${basedir}/target/generated_web.xml&#34;</span>
                <span style="color:#a6e22e">outputDir=</span><span style="color:#e6db74">&#34;${jsp.dest}&#34;</span>
                <span style="color:#a6e22e">compiler=</span><span style="color:#e6db74">&#34;${java.version}&#34;</span>
                <span style="color:#a6e22e">compilersourcevm=</span><span style="color:#e6db74">&#34;${java.version}&#34;</span>
                <span style="color:#a6e22e">compilertargetvm=</span><span style="color:#e6db74">&#34;${java.version}&#34;</span>
                <span style="color:#a6e22e">failonerror=</span><span style="color:#e6db74">&#34;true&#34;</span>
                <span style="color:#a6e22e">verbose=</span><span style="color:#e6db74">&#34;9&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/target&gt;</span>
 
    <span style="color:#f92672">&lt;target</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;compile&#34;</span><span style="color:#f92672">&gt;</span>
 
        <span style="color:#f92672">&lt;mkdir</span> <span style="color:#a6e22e">dir=</span><span style="color:#e6db74">&#34;${jsp.dest}&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;mkdir</span> <span style="color:#a6e22e">dir=</span><span style="color:#e6db74">&#34;${jsp.dest.compile}&#34;</span><span style="color:#f92672">/&gt;</span>
 
        <span style="color:#f92672">&lt;javac</span> <span style="color:#a6e22e">destdir=</span><span style="color:#e6db74">&#34;${jsp.dest.compile}&#34;</span>
               <span style="color:#a6e22e">optimize=</span><span style="color:#e6db74">&#34;off&#34;</span>
               <span style="color:#a6e22e">fork=</span><span style="color:#e6db74">&#34;true&#34;</span>
               <span style="color:#a6e22e">failonerror=</span><span style="color:#e6db74">&#34;true&#34;</span>
               <span style="color:#a6e22e">srcdir=</span><span style="color:#e6db74">&#34;${jsp.dest}&#34;</span>
               <span style="color:#a6e22e">memoryinitialsize=</span><span style="color:#e6db74">&#34;1024m&#34;</span>
               <span style="color:#a6e22e">memoryMaximumSize=</span><span style="color:#e6db74">&#34;1024m&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;classpath&gt;</span>
                <span style="color:#f92672">&lt;path</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;${maven.dependencies.classpath}&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/classpath&gt;</span>
            <span style="color:#f92672">&lt;include</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;**&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#75715e">&lt;!--&lt;exclude name=&#34;**/blabla*_jsp.java&#34;/&gt;--&gt;</span>
        <span style="color:#f92672">&lt;/javac&gt;</span>
 
    <span style="color:#f92672">&lt;/target&gt;</span>
 
    <span style="color:#f92672">&lt;target</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#a6e22e">depends=</span><span style="color:#e6db74">&#34;jspc,compile&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;/target&gt;</span>
 
<span style="color:#f92672">&lt;/project&gt;</span>
</code></pre></div><p>On peut constater quelques petites adaptations sur le script ant par rapport à la version proposée. Les raisons sont les suivantes :</p>
<ul>
<li>il ne me plaisait pas de dépendre de l&rsquo;emplacement d&rsquo;un conteneur de servlets pour effectuer une simple compilation : j&rsquo;ai préféré déclarer les lib de Tomcat via Maven. Etant dans un profil Maven particulié, l&rsquo;impact était négligeable pour le reste du projet,</li>
<li>je ne voulais pas que mes ressources générées partent n&rsquo;importe où : j&rsquo;ai donc précisé ces éléments dans les taches jasper et compile,</li>
<li>je n&rsquo;ai pas pris la target cleanup car j&rsquo;ai redirigé toutes mes générations dans le répertoire target géré par Maven.</li>
</ul>
<p>Par contre, j&rsquo;ai malheureusement été obligé de garder une dépendance à Tomcat pour le fichier <code>catalina-tasks.xml</code>. J&rsquo;aurais pu l&rsquo;embarqué en le customisant un peu et en récupérant, via Maven, les jars déclarés via la variable <code>CATALINA_HOME</code>, mais j&rsquo;avoue avoir été paresseux sur ce point&hellip; par contre, je pense que c&rsquo;est tout à fait possible de le faire.</p>
<p>On notera que la phase se fait en 2 passes :</p>
<ul>
<li>la première qui transforme les jsp en java (target <code>jspc</code>)</li>
<li>la deuxième qui compile réellement les java en class (target <code>compile</code>)</li>
</ul>
<p>Cependant, il reste encore un point qui mérite qu&rsquo;on s&rsquo;attarde un peu à cette solution&hellip; En effet, le <strong>maven-ant-plugin</strong> utilisé ici pour invoquer la target Ant depuis Maven s&rsquo;exécute avec la variable d&rsquo;environnement <code>JAVA_HOME</code> positionnée sur le JRE : <a href="http://docs.codehaus.org/display/MAVENUSER/Running+ant+tasks+that+use+the+JDK">http://docs.codehaus.org/display/MAVENUSER/Running+ant+tasks+that+use+the+JDK</a>.</p>
<p>Afin de palier à ce point, il convient de référencer en dépendance du plugin Ant la librairie <code>tools.jar</code>&hellip; (si ça, c&rsquo;est pas laid&hellip;!!!) et, en plus, de l&rsquo;utiliser avec un scope <code>system</code>&hellip; :'(</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>com.sun<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>tools<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.7.0<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;scope&gt;</span>system<span style="color:#f92672">&lt;/scope&gt;</span>
    <span style="color:#f92672">&lt;systemPath&gt;</span>${java.home}/../lib/tools.jar<span style="color:#f92672">&lt;/systemPath&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>###Conclusion</p>
<p>Au final, le plugin Ant fonctionne bien (même si je ne suis pas fan d&rsquo;appeler du Ant via Maven&hellip;) et répond au besoin de mon cahier des charges.</p>
<p>Même si cela m&rsquo;embête, c&rsquo;est la solution qui a été retenue&hellip; :'(</p>
<p>#Conclusion</p>
<p>En conclusion, comme vous avez pu le constater, j&rsquo;ai bien galéré avec une tache enfantine qui n&rsquo;était qu&rsquo;une simple validation des jsp par compilation.</p>
<p>Parmi les 3 solutions testées, seule une a réussi à remplir le cahier des charges qui, pourtant, était simple&hellip;</p>
<p>Aussi pas grand chose à conclure si ce n&rsquo;est que je tenais à faire partager mes petites galères si cela pouvait servir à quelqu&rsquo;un&hellip; ;-)</p>
<p>Le code est disponible <a href="https://github.com/jetoile/jsp-compile">ici</a> avec les différents profils :</p>
<ul>
<li><strong>jsp-compile-ant</strong>,</li>
<li><strong>jsp-compile-jspc-maven</strong>,</li>
<li><strong>jspc-compile-maven-jetty</strong>.</li>
</ul>
<p>Autre point (transverse) concernant Sitemesh (mais là, j&rsquo;y vais avec des pincettes car je connais très peu ce framework&hellip;)&hellip; :</p>
<p>La visibilité des variables (au sens scriptlet) n&rsquo;est pas possible entre le décorateur et la page décorée puisque les jsp sont compilées avant le passage de Sitemesh (<a href="http://wiki.sitemesh.org/display/sitemesh/Flow+Diagram)">http://wiki.sitemesh.org/display/sitemesh/Flow+Diagram)</a>. Par contre, les el sont tout à fait possible d&rsquo;un coté comme de l&rsquo;autre.</p>
<p>Pour avoir un exemple là dessus, c&rsquo;est accessible sur mon github (<a href="https://github.com/jetoile/jsp-compile">https://github.com/jetoile/jsp-compile</a>) dans les jsp menu.jsp, include.jsp et basic-theme.jsp qui sont, elles-même issues d&rsquo;un ensemble de copier/coller des tutoriels officiels.</p>
<p>En fait, c&rsquo;est surtout ce dernier point que les différents tests présentés dans cet article voulait validé&hellip; ;-)</p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.jetoile.fr%2fpost%2f2012-11-05-precompiler-ses-jsp%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2fblog.jetoile.fr%2fpost%2f2012-11-05-precompiler-ses-jsp%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2fblog.jetoile.fr%2fpost%2f2012-11-05-precompiler-ses-jsp%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2fblog.jetoile.fr%2fpost%2f2012-11-05-precompiler-ses-jsp%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.jetoile.fr%2fpost%2f2012-11-05-precompiler-ses-jsp%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2fblog.jetoile.fr%2fpost%2f2012-11-05-precompiler-ses-jsp%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://blog.jetoile.fr/post/2012-10-17-test-de-charge-mode-demploi/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://blog.jetoile.fr/post/2012-10-17-test-de-charge-mode-demploi/">Test de charge : mode d&#39;emploi</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://blog.jetoile.fr/post/2012-11-06-independance-me-voici/">Indépendance, me voici ;-)</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://blog.jetoile.fr/post/2012-11-06-independance-me-voici/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'jetoile';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  

</div>

</div>
</div>
<script src="https://blog.jetoile.fr/js/ui.js"></script>
<script src="https://blog.jetoile.fr/js/menus.js"></script>




<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-11955429-1', 'auto');
    ga('send', 'pageview');
  }
</script>





<script src="https://blog.jetoile.fr/js/math-code.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

