---
layout: post
title: "Maven pour les nuls... les archetypes"
date: 2011-06-05
comments: false
categories:
 - java
 - maven
 - archetype
---

<div class='post'>
<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-l-NZQRxE0vI/TevA5LfJQ_I/AAAAAAAAAXI/IP8zRk4wbeg/s1600/maven-logo-2.gif" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-l-NZQRxE0vI/TevA5LfJQ_I/AAAAAAAAAXI/IP8zRk4wbeg/s1600/maven-logo-2.gif" /></a></div><div style="text-align: justify;">Dans le cadre d'une problématique d'une usine logiciel, il peut s'avérer utile de posséder un patron ou template de projet qui fournit les "bonnes" pratiques que doivent respecter l'ensemble des applications du projet.</div><div style="text-align: justify;">Bien sûr, notre cher IDE est capable de générer un joli patron de projet. Cependant, il reste toujours nécessaire de modifier la configuration du projet pour y mettre, par exemple :</div><ul><li>la version de jdk,</li><li>les libs utilisées (comme mockito par exemple),</li><li>optionnellement, la configuration de plugins,</li><li>optionnellemet, l'url du SCM,</li><li>ou tout simplement, la référence à un projet parent qui permet de définir, par exemple, la version des librairies ou des plugins utilisés.&nbsp;</li></ul><div style="text-align: justify;">Le hic, c'est que, généralement, cela fini par de jolis copier/coller dont le résultat diffère, bien sûr, en fonction du projet qui a servi de template. Le résultat : le syndrome du téléphone arabe sachant qu'en plus, on n'est même plus capable de savoir qu'elle était la référence du départ... embêtant tout ça... surtout pour un projet se voulant industriel...</div><div style="text-align: justify;">En outre, posséder un patron de projet peut également s'avérer utile si vous êtes amené à <em>POCer</em> des frameworks ou faire des projets perso chez vous...</div><div style="text-align: justify;">Vous l'aurez compris, cet article se focalisera sur les projets construits sur maven où les notions de dépendances, de plugins, d'informations projet sont présentes dans le pom.</div><div style="text-align: justify;">Cet article a donc pour objectif de montrer comment il est possible de créer un archetype maven qui permet de répondre à ce problème.</div><div style="text-align: justify;">Le use case sera simple puisque je m'appuierai sur la création d'un archetype simple pour mes besoins personnels afin de me fournir un patron normalisé (selon mes normes) me permettant de démarrer un POC rapidement pour un artifact de type jar et cela dans le seul but de ne pas avoir à faire moultes copier/coller... ;-)</div><div style="text-align: justify;">A noter qu'il n'y a rien de révolutionnaire dans cet article pour toutes les personnes qui ont quelques connaissances de base en maven mais qu'il peut s'avérer utile (enfin j'espère) pour les autres... ;-) </div><!-- more --><br /><h1>Méthodologie</h1><div style="text-align: justify;">Afin de créer un archetype, il existe plusieurs méthodes :</div><ul><li style="text-align: justify;">la première consiste à créer l'archetype directement, chose pas trop complexe mais qui demande d'être rodée à la chose,</li><li style="text-align: justify;">la deuxième consiste à créer le projet maven tel que l'on souhaiterait que l'archetype nous le créer et de demander à maven de nous générer l'archetype en lui-même. Suite à cela, il convient de modifier l'archetype généré afin de le rendre configurable (nom des packages, ...).</li></ul><div style="text-align: justify;">Suite à cela, il convient d'installer (ou de déployer) notre archetype au sein de notre repository (global ou distant) afin de le rendre accessible aux autres membres de l'équipe ou tout simplement à soi-même.</div><div style="text-align: justify;">Dans mon cas, j'utiliserai la deuxième méthode qui consiste donc à générer l'archetype à partir du projet maven que je souhaite avoir.</div><h1>Création du projet de base</h1><div style="text-align: justify;">Comme je l'ai dit précédemment, mes besoins sont purement personnels et mon projet devra répondre aux points suivants :</div><ul><li style="text-align: justify;">un seul projet,</li><li style="text-align: justify;">de type jar,</li><li style="text-align: justify;">utilisant un jdk 6,</li><li style="text-align: justify;">déclarant les librairies suivantes : slf4j, logback-classic, commons-lang</li><li style="text-align: justify;">déclarant les librairies suivantes&nbsp;pour mes TUs&nbsp;: JUnit, mockito, powermock</li><li style="text-align: justify;">déclarant et configurant le plugin checkstyle et dont les rules seront dans le projet en lui-même</li><li style="text-align: justify;">déclarant et configurant le plugin assembly afin de me permettre de fournir, au besoin, un livrable</li><li style="text-align: justify;">déclarant le plugin source afin de me permettre de générer un jar de source</li></ul><div style="text-align: justify;">Bien sûr, il tentera de suivre au mieux les bonnes pratiques maven...</div><div style="text-align: justify;">Cette partie n'étant pas bien intéressante et étant spécifique aux besoins de chacun, je la détaillerai donc peu...</div><div style="text-align: justify;">Sa structure :</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-ActIqf-Gkv8/TevBObqDojI/AAAAAAAAAXM/TRHrtsoB8L0/s1600/archetype01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/-ActIqf-Gkv8/TevBObqDojI/AAAAAAAAAXM/TRHrtsoB8L0/s320/archetype01.png" width="303" /></a></div>Son pom :<br /><pre class="brush:xml; wrap-lines: false; auto-links: false"><project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><build><plugins>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br /> xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br /> &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br /> &lt;groupId&gt;fr.jetoile&lt;/groupId&gt;<br /> &lt;artifactId&gt;project-template&lt;/artifactId&gt;<br /> &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br /><br /> &lt;properties&gt;<br />  &lt;java.version&gt;1.6&lt;/java.version&gt;<br /><br />  &lt;junit.version&gt;4.8.1&lt;/junit.version&gt;<br />  &lt;slf4j.version&gt;1.6.1&lt;/slf4j.version&gt;<br />  &lt;logback.version&gt;0.9.27&lt;/logback.version&gt;<br />  &lt;commons-lang.version&gt;2.5&lt;/commons-lang.version&gt;<br />  &lt;powermock.version&gt;1.4.7&lt;/powermock.version&gt;<br />  &lt;mockito.version&gt;1.8.5&lt;/mockito.version&gt;<br /> &lt;/properties&gt;<br /><br /> &lt;!-- distributionManagement&gt;<br />  &lt;repository&gt;<br />   &lt;id&gt;nexus&lt;/id&gt;<br />   &lt;url&gt;http://localhost:8080/nexus/content/repositories/releases&lt;/url&gt;<br />  &lt;/repository&gt;<br />  &lt;snapshotRepository&gt;<br />   &lt;id&gt;nexus&lt;/id&gt;<br />   &lt;name&gt;Nexus snapshot Repository&lt;/name&gt;<br />   &lt;url&gt;http://localhost:8080/nexus/content/repositories/snapshots&lt;/url&gt;<br />  &lt;/snapshotRepository&gt;<br /> &lt;/distributionManagement&gt;<br /> &lt;scm&gt;<br />  &lt;developerConnection&gt;scm:svn:svn://localhost/projet/trunk/TODO&lt;/developerConnection&gt;<br /> &lt;/scm--&gt;<br /><br /><br /> &lt;developers&gt;<br />  &lt;developer&gt;<br />   &lt;email&gt;kmx.petals@gmail.com&lt;/email&gt;<br />   &lt;id&gt;khanh&lt;/id&gt;<br />   &lt;roles&gt;<br />    &lt;role&gt;developer&lt;/role&gt;<br />   &lt;/roles&gt;<br />  &lt;/developer&gt;<br /> &lt;/developers&gt;<br /><br /> &lt;dependencies&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br />   &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;<br />   &lt;version&gt;${logback.version}&lt;/version&gt;<br />  &lt;/dependency&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />   &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;<br />   &lt;version&gt;${slf4j.version}&lt;/version&gt;<br />  &lt;/dependency&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;commons-lang&lt;/groupId&gt;<br />   &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;<br />   &lt;version&gt;${commons-lang.version}&lt;/version&gt;<br />  &lt;/dependency&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;org.mockito&lt;/groupId&gt;<br />   &lt;artifactId&gt;mockito-all&lt;/artifactId&gt;<br />   &lt;version&gt;${mockito.version}&lt;/version&gt;<br />   &lt;scope&gt;test&lt;/scope&gt;<br />  &lt;/dependency&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;org.powermock&lt;/groupId&gt;<br />   &lt;artifactId&gt;powermock-module-junit4&lt;/artifactId&gt;<br />   &lt;version&gt;${powermock.version}&lt;/version&gt;<br />   &lt;scope&gt;test&lt;/scope&gt;<br />  &lt;/dependency&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;junit&lt;/groupId&gt;<br />   &lt;artifactId&gt;junit&lt;/artifactId&gt;<br />   &lt;version&gt;${junit.version}&lt;/version&gt;<br />   &lt;scope&gt;test&lt;/scope&gt;<br />  &lt;/dependency&gt;<br />  &lt;dependency&gt;<br />   &lt;groupId&gt;org.powermock&lt;/groupId&gt;<br />   &lt;artifactId&gt;powermock-api-mockito&lt;/artifactId&gt;<br />   &lt;version&gt;${powermock.version}&lt;/version&gt;<br />   &lt;scope&gt;test&lt;/scope&gt;<br />  &lt;/dependency&gt;<br /> &lt;/dependencies&gt;<br /><br /><br /> &lt;build&gt;<br />  &lt;plugins&gt;<br />   &lt;plugin&gt;<br />    &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.6&lt;/version&gt;<br />   &lt;/plugin&gt;<br /><br />   &lt;plugin&gt;<br />    &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.1&lt;/version&gt;<br />   &lt;/plugin&gt;<br /><br />   &lt;plugin&gt;<br />    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br />    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.3.2&lt;/version&gt;<br />    &lt;configuration&gt;<br />     &lt;source&gt;${java.version}&lt;/source&gt;<br />     &lt;target&gt;${java.version}&lt;/target&gt;<br />    &lt;/configuration&gt;<br />   &lt;/plugin&gt;<br /><br />   &lt;plugin&gt;<br />    &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.6&lt;/version&gt;<br />    &lt;configuration&gt;<br />     &lt;configLocation&gt;src/config/custom-checkstyle.xml&lt;/configLocation&gt;<br />     &lt;includeTestSourceDirectory&gt;false&lt;/includeTestSourceDirectory&gt;<br />     &lt;logViolationsToConsole&gt;true&lt;/logViolationsToConsole&gt;<br />    &lt;/configuration&gt;<br />    &lt;executions&gt;<br />     &lt;execution&gt;<br />      &lt;phase&gt;compile&lt;/phase&gt;<br />      &lt;goals&gt;<br />       &lt;goal&gt;check&lt;/goal&gt;<br />      &lt;/goals&gt;<br />     &lt;/execution&gt;<br />    &lt;/executions&gt;<br />   &lt;/plugin&gt;<br /><br />   &lt;plugin&gt;<br />    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.2.1&lt;/version&gt;<br />    &lt;configuration&gt;<br />     &lt;descriptors&gt;<br />      &lt;descriptor&gt;src/assembly/src.xml&lt;/descriptor&gt;<br />     &lt;/descriptors&gt;<br />    &lt;/configuration&gt;<br />    &lt;executions&gt;<br />     &lt;execution&gt;<br />      &lt;id&gt;make-assembly&lt;/id&gt;<br />      &lt;phase&gt;install&lt;/phase&gt;<br />      &lt;goals&gt;<br />       &lt;goal&gt;single&lt;/goal&gt;<br />      &lt;/goals&gt;<br />     &lt;/execution&gt;<br />    &lt;/executions&gt;<br />   &lt;/plugin&gt;<br /><br />   &lt;plugin&gt;<br />    &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;<br />    &lt;version&gt;2.1.2&lt;/version&gt;<br />    &lt;executions&gt;<br />     &lt;execution&gt;<br />      &lt;phase&gt;package&lt;/phase&gt;<br />      &lt;goals&gt;<br />       &lt;goal&gt;jar&lt;/goal&gt;<br />      &lt;/goals&gt;<br />     &lt;/execution&gt;<br />    &lt;/executions&gt;<br />   &lt;/plugin&gt;<br />  &lt;/plugins&gt;<br /> &lt;/build&gt;<br />&lt;/project&gt;  </plugins><br /> </build><br /></project></pre>Son fichier assembly :<br /><pre class="brush:xml; wrap-lines: false; auto-links: false"><assembly><br /></assembly>&lt;assembly&gt;<br /> &lt;id&gt;bin&lt;/id&gt;<br /> &lt;formats&gt;<br />  &lt;format&gt;zip&lt;/format&gt;<br /> &lt;/formats&gt;<br /> &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;<br /> &lt;dependencySets&gt;<br />  &lt;dependencySet&gt;<br />   &lt;scope&gt;compile&lt;/scope&gt;<br />   &lt;useProjectArtifact&gt;true&lt;/useProjectArtifact&gt;<br />   &lt;useTransitiveDependencies&gt;true&lt;/useTransitiveDependencies&gt;<br />   &lt;outputDirectory&gt;lib&lt;/outputDirectory&gt;<br />  &lt;/dependencySet&gt;<br /> &lt;/dependencySets&gt;<br /><br /> &lt;fileSets&gt;<br />  &lt;fileSet&gt;<br />   &lt;directory&gt;target/&lt;/directory&gt;<br />   &lt;outputDirectory&gt;sources&lt;/outputDirectory&gt;<br />   &lt;includes&gt;<br />    &lt;include&gt;**sources.jar&lt;/include&gt;<br />   &lt;/includes&gt;<br />  &lt;/fileSet&gt;<br />  &lt;fileSet&gt;<br />   &lt;directory&gt;bin/&lt;/directory&gt;<br />   &lt;outputDirectory&gt;bin&lt;/outputDirectory&gt;<br />  &lt;/fileSet&gt;<br /> &lt;/fileSets&gt;<br /><br />&lt;/assembly&gt;</pre><h1>Création de l'archetype</h1><div style="text-align: justify;">La création de l'archetype est simple puisqu'il suffit de lancer la commande suivante :</div><pre class="brush:bash; wrap-lines: false; auto-links: false">mvn archetype:create-from-project</pre><div style="text-align: justify;">Suite à cela, notre archetype se trouve dans le répertoire target/generated-sources/archetype et a la structure suivante :</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-QGyUib6583A/TevDZZVezbI/AAAAAAAAAXQ/lHGC3y6oLew/s1600/archetype02.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-QGyUib6583A/TevDZZVezbI/AAAAAAAAAXQ/lHGC3y6oLew/s1600/archetype02.png" /></a></div><br />Son pom :<br /><pre class="brush:xml; wrap-lines: false; auto-links: false"><project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br /></project>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br />  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br /><br />  &lt;groupId&gt;fr.jetoile&lt;/groupId&gt;<br />  &lt;artifactId&gt;project-template-archetype&lt;/artifactId&gt;<br />  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br />  &lt;packaging&gt;maven-archetype&lt;/packaging&gt;<br /><br />  &lt;name&gt;project-template-archetype&lt;/name&gt;<br /><br />  &lt;build&gt;<br />    &lt;extensions&gt;<br />      &lt;extension&gt;<br />        &lt;groupId&gt;org.apache.maven.archetype&lt;/groupId&gt;<br />        &lt;artifactId&gt;archetype-packaging&lt;/artifactId&gt;<br />        &lt;version&gt;2.0&lt;/version&gt;<br />      &lt;/extension&gt;<br />    &lt;/extensions&gt;<br /><br />    &lt;pluginManagement&gt;<br />      &lt;plugins&gt;<br />        &lt;plugin&gt;<br />          &lt;artifactId&gt;maven-archetype-plugin&lt;/artifactId&gt;<br />          &lt;version&gt;2.0&lt;/version&gt;<br />        &lt;/plugin&gt;<br />      &lt;/plugins&gt;<br />    &lt;/pluginManagement&gt;<br />  &lt;/build&gt;<br />&lt;/project&gt;<br /></pre><div><br /></div><div style="text-align: justify;">On constate qu'il y a deux points à noter dans cette structure d'archetype générée :</div><ul><li style="text-align: justify;">le patron de notre template de projet qui sera utilisé par maven lors de l'appel au goal archetype:generate se trouve dans le répertoire src/main/resources/archetype-resources/src,</li><li style="text-align: justify;">dans le répertoire src/main/resources/META-INF/maven, se trouve le fichier archetype-metadata.xml qui contient le descriptif de ce qui doit être généré :</li></ul><pre class="brush:xml; wrap-lines: false; auto-links: false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;archetype-descriptor xsi:schemaLocation="http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0 http://maven.apache.org/xsd/archetype-descriptor-1.0.0.xsd" name="project-template"<br />    xmlns="http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0"<br />    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;<br />    <br />  &lt;fileSets&gt;<br />    &lt;fileSet filtered="true" packaged="true" encoding="UTF-8"&gt;<br />      &lt;directory&gt;src/main/java&lt;/directory&gt;<br />      &lt;includes&gt;<br />        &lt;include&gt;**/*.java&lt;/include&gt;<br />      &lt;/includes&gt;<br />    &lt;/fileSet&gt;<br />    &lt;fileSet filtered="true" packaged="true" encoding="UTF-8"&gt;<br />      &lt;directory&gt;src/test/java&lt;/directory&gt;<br />      &lt;includes&gt;<br />        &lt;include&gt;**/*.java&lt;/include&gt;<br />      &lt;/includes&gt;<br />    &lt;/fileSet&gt;<br />    &lt;fileSet filtered="true" encoding="UTF-8"&gt;<br />      &lt;directory&gt;src/config&lt;/directory&gt;<br />      &lt;includes&gt;<br />        &lt;include&gt;**/*.xml&lt;/include&gt;<br />      &lt;/includes&gt;<br />    &lt;/fileSet&gt;<br />    &lt;fileSet filtered="true" encoding="UTF-8"&gt;<br />      &lt;directory&gt;src/assembly&lt;/directory&gt;<br />      &lt;includes&gt;<br />        &lt;include&gt;**/*.xml&lt;/include&gt;<br />      &lt;/includes&gt;<br />    &lt;/fileSet&gt;<br />    &lt;fileSet filtered="true" encoding="UTF-8"&gt;<br />      &lt;directory&gt;&lt;/directory&gt;<br />      &lt;includes&gt;<br />        &lt;include&gt;README.txt&lt;/include&gt;<br />      &lt;/includes&gt;<br />    &lt;/fileSet&gt;<br />  &lt;/fileSets&gt;<br />&lt;/archetype-descriptor&gt;<br /></pre><div><br /></div><div style="text-align: justify;">A cette étape, il est tout de suite possible d'installer l'archetype dans le repository maven (cf. Mise à disposition de l'archetype) et de l'invoquer (cf. Utilisation et résultat de l'archetype).<br />A noter qu'ici, il peut être intéressant de supprimer le support des .project, .classpath et .settings si le template a été géré avec eclipse.</div><h1>Transformation de l'archetype</h1><div style="text-align: justify;">Dans le cadre de mon petit use case, je n'ai pas beaucoup besoin de <em>customiser</em> mon archetype. En effet, je souhaite seulement pouvoir demander à l'utilisateur (en l'occurence moi ;-) ), quel sera le nom de ma classe à me générer.</div><div style="text-align: justify;">Pour ce faire, il n'y a qu'à ajouter une propriété dans le fichier src/main/resources/META-INF/maven/archetype-metadata.xml :</div><pre class="brush:xml; wrap-lines: false; auto-links: false">&lt;requiredProperties&gt;<br />    &lt;requiredProperty key="className"&gt;<br />      &lt;defaultValue&gt;MyClass&lt;/defaultValue&gt;<br />    &lt;/requiredProperty&gt;<br />&lt;/requiredProperties&gt;<br /></pre><div style="text-align: justify;">Modifier le nom des fichiers java :</div><ul><li>Test.java en __className__.java</li><li>TestTest en __className__.java</li></ul>Et remplacer dans les fichiers respectifs :<br /><pre class="brush:java; wrap-lines: false; auto-links: false">public class Test {</pre>en<br /><pre class="brush:java; wrap-lines: false; auto-links: false">public class ${className} {</pre>et<br /><pre class="brush:java; wrap-lines: false; auto-links: false">public class TestTest {</pre>en<br /><pre class="brush:java; wrap-lines: false; auto-links: false">public class ${className}Test {</pre><div style="text-align: justify;">En outre, il faut également modifier le fichier src/test/resources/projects/basic/archetype.properties pour y ajouter la ligne suivante :</div><pre class="brush:bash; wrap-lines: false; auto-links: false">className=MyClass<br /></pre><div style="text-align: justify;">Enfin, il est possible de figer la version de l'archetype en modifiant le pom du projet ainsi que son artifactId et son groupId.&nbsp;Dans mon cas, il restera identique.</div><h1>Mise à disposition de l'archetype</h1><div style="text-align: justify;">Une fois que l'archetype a été modifié pour répondre aux besoins, il n'y a plus qu'à exécuter la commande mvn install pour déployer l'archetype dans le repository local et la commande mvn deploy pour le déployer dans le repository partagé.</div><h1>Utilisation et résultat de l'archetype</h1><div style="text-align: justify;">Une fois l'archetype déployé dans le repository adéquate, il n'y a plus qu'à l'invoquer via la commande :</div><pre class="brush:bash; wrap-lines: false; auto-links: false">mvn archetype:generate \<br />&nbsp;-DarchetypeGroupId=fr.jetoile \<br />&nbsp;-DarchetypeArtifactId=project-template-archetype \<br />&nbsp;-DarchetypeVersion=0.0.1-SNAPSHOT \<br />&nbsp;-DgroupId=fr.jetoile \<br />&nbsp;-DartifactId=test-archetype<br /></pre>Ainsi, le résultat obtenu est le suivant :<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-IyLOW6pbUgw/TevFCch0TRI/AAAAAAAAAXU/-8aUatC2M5c/s1600/archetype04.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-IyLOW6pbUgw/TevFCch0TRI/AAAAAAAAAXU/-8aUatC2M5c/s1600/archetype04.png" /></a></div><br /><h1>Conclusion</h1><div style="text-align: justify;">Nous avons vu dans cet article qu'il était extrêmement simple de créer un archetype maven, action qui peut s'avérer très utile pour gagner du temps que ce soit pour des besoins personnels ou dans un cadre d'industrialisation du processus d'initialisation d'un projet dans une équipe.<br /><br /><b>[update]</b> Je viens de mettre sur github le code :<br /><br /><ul><li>du projet utilisé pour créer l'archetype ainsi que le code de l'archetype :&nbsp;<a href="https://github.com/jetoile/project-template">https://github.com/jetoile/project-template</a>&nbsp;</li><li>du projet permettant de créer l'archetype :&nbsp;<a href="https://github.com/jetoile/project-template-archetype">https://github.com/jetoile/project-template-archetype</a></li></ul><br /><br /></div><div style="text-align: justify;">Cependant, je n'ai pas invoqué ici le cas de projets multimodules mais le principe reste identique, même s'il est possible d'utiliser d'autres templates (tel que __rootArtifactId__) si l'on souhaite préfixer le nom des modules avec l'artifactId du projet généré ou si l'on souhaite customiser plus finement un nom de répertoire (ou package) : dans ce cas, il peut être souhaitable d'ajouter d'autres propriétés dans le fichier archetype-metadata.xml :</div><br /><pre class="brush:xml; wrap-lines: false; auto-links: false">&lt;module id="${rootArtifactId}-core" dir="__rootArtifactId__-core" name="${rootArtifactId}-core"&gt;<br />      &lt;fileSets&gt;<br />        &lt;fileSet filtered="true" encoding="UTF-8" packaged="true"&gt;<br />          &lt;directory&gt;src/main/java&lt;/directory&gt;<br />          &lt;includes&gt;<br />            &lt;include&gt;**/*.java&lt;/include&gt;<br />          &lt;/includes&gt;<br />        &lt;/fileSet&gt;<br />        &lt;fileSet filtered="true" encoding="UTF-8" packaged="true"&gt;<br />          &lt;directory&gt;src/test/java&lt;/directory&gt;<br />          &lt;includes&gt;<br />            &lt;include&gt;**/*.java&lt;/include&gt;<br />          &lt;/includes&gt;<br />        &lt;/fileSet&gt;<br />      &lt;/fileSets&gt;<br />    &lt;/module&gt;<br />    &lt;module id="${rootArtifactId}-client" dir="__rootArtifactId__-client" name="${rootArtifactId}-client"&gt;<br />      &lt;fileSets&gt;<br />        &lt;fileSet filtered="true" encoding="UTF-8" packaged="true"&gt;<br />          &lt;directory&gt;src/main/java&lt;/directory&gt;<br />          &lt;includes&gt;<br />            &lt;include&gt;**/*.java&lt;/include&gt;<br />          &lt;/includes&gt;<br />        &lt;/fileSet&gt;<br />        &lt;fileSet filtered="true" encoding="UTF-8" packaged="true"&gt;<br />          &lt;directory&gt;src/main/resources&lt;/directory&gt;<br />          &lt;includes&gt;<br />            &lt;include&gt;**/*.xml&lt;/include&gt;<br />            &lt;include&gt;**/*.properties&lt;/include&gt;<br />          &lt;/includes&gt;<br />        &lt;/fileSet&gt;<br />        &lt;fileSet filtered="true" encoding="UTF-8" packaged="true"&gt;<br />          &lt;directory&gt;src/test/resources&lt;/directory&gt;<br />          &lt;includes&gt;<br />            &lt;include&gt;**/*.xml&lt;/include&gt;<br />            &lt;include&gt;**/*.properties&lt;/include&gt;<br />          &lt;/includes&gt;<br />        &lt;/fileSet&gt;<br />      &lt;/fileSets&gt;<br />    &lt;/module&gt;</pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-VL7re_vr97E/TevFPbO9msI/AAAAAAAAAXY/tXBaVB_kG-0/s1600/archetype03.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-VL7re_vr97E/TevFPbO9msI/AAAAAAAAAXY/tXBaVB_kG-0/s320/archetype03.png" width="192" /></a></div><h1>Pour aller plus loin...</h1><ul><li style="text-align: justify;"><strong>Apache Maven</strong>&nbsp;de N. De Loof, A. Héritier chez Pearson</li><li style="text-align: justify;"><strong>Better Builds with Maven</strong>&nbsp;:&nbsp;<a href="http://repo.exist.com/dist/maestro/1.7.0/BetterBuildsWithMaven.pdf">http://repo.exist.com/dist/maestro/1.7.0/BetterBuildsWithMaven.pdf</a></li><li style="text-align: justify;"><strong>Maven. Definitive Guide</strong>&nbsp;:&nbsp;<a href="http://www.sonatype.com/products/maven/documentation/book-defguide">http://www.sonatype.com/products/maven/documentation/book-defguide</a></li></ul><ul><li style="text-align: justify;"><strong>Site de maven</strong>&nbsp;:&nbsp;<a href="http://maven.apache.org/">http://maven.apache.org/</a></li></ul></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Khanh</div>
<div class='content'>
Cool! Merci pour le commentaire et content que mes articles servent ;-)</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Billet très intéressant et qui me sera très utile pour remplacer les &#39;brouillons&#39; de templates fournis par SpringSource dans son STS.</div>
</div>
</div>
